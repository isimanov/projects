{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Иван, ты хорошо доработал проект и получил интересные результаты, надеюсь ты прокачал свои навыки и узнал много нового! Желаю тебе успехов в дальнейшем постижении анализа данных.\n",
    "    \n",
    "P.s. только больше не удаляй комментарии ревьюверов\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Исследование надёжности заёмщиков\n",
    "\n",
    "Заказчик — кредитный отдел банка. Нужно разобраться, влияет ли семейное положение и количество детей клиента на факт погашения кредита в срок. Входные данные от банка — статистика о платёжеспособности клиентов.\n",
    "\n",
    "Результаты исследования будут учтены при построении модели **кредитного скоринга** — специальной системы, которая оценивает способность потенциального заёмщика вернуть кредит банку."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## План исследования\n",
    "\n",
    "### 1. Общая информация о данных\n",
    "    - Посмотрим начало и конец датасета, отдельные столбцы\n",
    "    - Сделаем предварительные выводы\n",
    "    - Поищем аномалии\n",
    "### 2. Предобработка данных\n",
    "    - Определим и заполним пропущенные значения\n",
    "    - Заменим вещественный тип данных на целочисленный\n",
    "    - Удалим дубликаты\n",
    "    - Выделим леммы в значениях столбца с целями получения кредита\n",
    "    - Категоризируем данные\n",
    "### 3. Ответ на поставленные вопросы\n",
    "    - Есть ли зависимость между наличием детей и возвратом кредита в срок?\n",
    "    - Есть ли зависимость между семейным положением и возвратом кредита в срок?\n",
    "    - Есть ли зависимость между уровнем дохода и возвратом кредита в срок?\n",
    "    - Как разные цели кредита влияют на его возврат в срок?\n",
    "### 4. Результаты исследования\n",
    "    - Общий вывод\n",
    "    - Рекомендации"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Шаг 1. Откройте файл с данными и изучите общую информацию. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "ks = pd.read_csv('/datasets/data.csv')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Описание данных\n",
    "    •\tchildren — количество детей в семье\n",
    "    •\tdays_employed — общий трудовой стаж в днях\n",
    "    •\tdob_years — возраст клиента в годах\n",
    "    •\teducation — уровень образования клиента\n",
    "    •\teducation_id — идентификатор уровня образования\n",
    "    •\tfamily_status — семейное положение\n",
    "    •\tfamily_status_id — идентификатор семейного положения\n",
    "    •\tgender — пол клиента\n",
    "    •\tincome_type — тип занятости\n",
    "    •\tdebt — имел ли задолженность по возврату кредитов\n",
    "    •\ttotal_income — ежемесячный доход\n",
    "    •\tpurpose — цель получения кредита\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 21525 entries, 0 to 21524\n",
      "Data columns (total 12 columns):\n",
      "children            21525 non-null int64\n",
      "days_employed       19351 non-null float64\n",
      "dob_years           21525 non-null int64\n",
      "education           21525 non-null object\n",
      "education_id        21525 non-null int64\n",
      "family_status       21525 non-null object\n",
      "family_status_id    21525 non-null int64\n",
      "gender              21525 non-null object\n",
      "income_type         21525 non-null object\n",
      "debt                21525 non-null int64\n",
      "total_income        19351 non-null float64\n",
      "purpose             21525 non-null object\n",
      "dtypes: float64(2), int64(5), object(5)\n",
      "memory usage: 2.0+ MB\n"
     ]
    }
   ],
   "source": [
    "ks.info() # Общая информация по датасету"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>children</th>\n",
       "      <th>days_employed</th>\n",
       "      <th>dob_years</th>\n",
       "      <th>education_id</th>\n",
       "      <th>family_status_id</th>\n",
       "      <th>debt</th>\n",
       "      <th>total_income</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>count</th>\n",
       "      <td>21525.000000</td>\n",
       "      <td>19351.000000</td>\n",
       "      <td>21525.000000</td>\n",
       "      <td>21525.000000</td>\n",
       "      <td>21525.000000</td>\n",
       "      <td>21525.000000</td>\n",
       "      <td>1.935100e+04</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mean</th>\n",
       "      <td>0.538908</td>\n",
       "      <td>63046.497661</td>\n",
       "      <td>43.293380</td>\n",
       "      <td>0.817236</td>\n",
       "      <td>0.972544</td>\n",
       "      <td>0.080883</td>\n",
       "      <td>1.674223e+05</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>std</th>\n",
       "      <td>1.381587</td>\n",
       "      <td>140827.311974</td>\n",
       "      <td>12.574584</td>\n",
       "      <td>0.548138</td>\n",
       "      <td>1.420324</td>\n",
       "      <td>0.272661</td>\n",
       "      <td>1.029716e+05</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>min</th>\n",
       "      <td>-1.000000</td>\n",
       "      <td>-18388.949901</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>2.066726e+04</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25%</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>-2747.423625</td>\n",
       "      <td>33.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.030532e+05</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50%</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>-1203.369529</td>\n",
       "      <td>42.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.450179e+05</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75%</th>\n",
       "      <td>1.000000</td>\n",
       "      <td>-291.095954</td>\n",
       "      <td>53.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>2.034351e+05</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>max</th>\n",
       "      <td>20.000000</td>\n",
       "      <td>401755.400475</td>\n",
       "      <td>75.000000</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>2.265604e+06</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "           children  days_employed     dob_years  education_id  \\\n",
       "count  21525.000000   19351.000000  21525.000000  21525.000000   \n",
       "mean       0.538908   63046.497661     43.293380      0.817236   \n",
       "std        1.381587  140827.311974     12.574584      0.548138   \n",
       "min       -1.000000  -18388.949901      0.000000      0.000000   \n",
       "25%        0.000000   -2747.423625     33.000000      1.000000   \n",
       "50%        0.000000   -1203.369529     42.000000      1.000000   \n",
       "75%        1.000000    -291.095954     53.000000      1.000000   \n",
       "max       20.000000  401755.400475     75.000000      4.000000   \n",
       "\n",
       "       family_status_id          debt  total_income  \n",
       "count      21525.000000  21525.000000  1.935100e+04  \n",
       "mean           0.972544      0.080883  1.674223e+05  \n",
       "std            1.420324      0.272661  1.029716e+05  \n",
       "min            0.000000      0.000000  2.066726e+04  \n",
       "25%            0.000000      0.000000  1.030532e+05  \n",
       "50%            0.000000      0.000000  1.450179e+05  \n",
       "75%            1.000000      0.000000  2.034351e+05  \n",
       "max            4.000000      1.000000  2.265604e+06  "
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks.describe() # Общие параметры таблицы"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Посмотрим начало и конец таблицы"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>children</th>\n",
       "      <th>days_employed</th>\n",
       "      <th>dob_years</th>\n",
       "      <th>education</th>\n",
       "      <th>education_id</th>\n",
       "      <th>family_status</th>\n",
       "      <th>family_status_id</th>\n",
       "      <th>gender</th>\n",
       "      <th>income_type</th>\n",
       "      <th>debt</th>\n",
       "      <th>total_income</th>\n",
       "      <th>purpose</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>-8437.673028</td>\n",
       "      <td>42</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>253875.639453</td>\n",
       "      <td>покупка жилья</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>-4024.803754</td>\n",
       "      <td>36</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>112080.014102</td>\n",
       "      <td>приобретение автомобиля</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>-5623.422610</td>\n",
       "      <td>33</td>\n",
       "      <td>Среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>145885.952297</td>\n",
       "      <td>покупка жилья</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3</td>\n",
       "      <td>-4124.747207</td>\n",
       "      <td>32</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>267628.550329</td>\n",
       "      <td>дополнительное образование</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>340266.072047</td>\n",
       "      <td>53</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>158616.077870</td>\n",
       "      <td>сыграть свадьбу</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>0</td>\n",
       "      <td>-926.185831</td>\n",
       "      <td>27</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>M</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>255763.565419</td>\n",
       "      <td>покупка жилья</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>0</td>\n",
       "      <td>-2879.202052</td>\n",
       "      <td>43</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>240525.971920</td>\n",
       "      <td>операции с жильем</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>0</td>\n",
       "      <td>-152.779569</td>\n",
       "      <td>50</td>\n",
       "      <td>СРЕДНЕЕ</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>135823.934197</td>\n",
       "      <td>образование</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2</td>\n",
       "      <td>-6929.865299</td>\n",
       "      <td>35</td>\n",
       "      <td>ВЫСШЕЕ</td>\n",
       "      <td>0</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>95856.832424</td>\n",
       "      <td>на проведение свадьбы</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>0</td>\n",
       "      <td>-2188.756445</td>\n",
       "      <td>41</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>144425.938277</td>\n",
       "      <td>покупка жилья для семьи</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   children  days_employed  dob_years education  education_id  \\\n",
       "0         1   -8437.673028         42    высшее             0   \n",
       "1         1   -4024.803754         36   среднее             1   \n",
       "2         0   -5623.422610         33   Среднее             1   \n",
       "3         3   -4124.747207         32   среднее             1   \n",
       "4         0  340266.072047         53   среднее             1   \n",
       "5         0    -926.185831         27    высшее             0   \n",
       "6         0   -2879.202052         43    высшее             0   \n",
       "7         0    -152.779569         50   СРЕДНЕЕ             1   \n",
       "8         2   -6929.865299         35    ВЫСШЕЕ             0   \n",
       "9         0   -2188.756445         41   среднее             1   \n",
       "\n",
       "      family_status  family_status_id gender income_type  debt   total_income  \\\n",
       "0   женат / замужем                 0      F   сотрудник     0  253875.639453   \n",
       "1   женат / замужем                 0      F   сотрудник     0  112080.014102   \n",
       "2   женат / замужем                 0      M   сотрудник     0  145885.952297   \n",
       "3   женат / замужем                 0      M   сотрудник     0  267628.550329   \n",
       "4  гражданский брак                 1      F   пенсионер     0  158616.077870   \n",
       "5  гражданский брак                 1      M   компаньон     0  255763.565419   \n",
       "6   женат / замужем                 0      F   компаньон     0  240525.971920   \n",
       "7   женат / замужем                 0      M   сотрудник     0  135823.934197   \n",
       "8  гражданский брак                 1      F   сотрудник     0   95856.832424   \n",
       "9   женат / замужем                 0      M   сотрудник     0  144425.938277   \n",
       "\n",
       "                      purpose  \n",
       "0               покупка жилья  \n",
       "1     приобретение автомобиля  \n",
       "2               покупка жилья  \n",
       "3  дополнительное образование  \n",
       "4             сыграть свадьбу  \n",
       "5               покупка жилья  \n",
       "6           операции с жильем  \n",
       "7                 образование  \n",
       "8       на проведение свадьбы  \n",
       "9     покупка жилья для семьи  "
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks.head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>children</th>\n",
       "      <th>days_employed</th>\n",
       "      <th>dob_years</th>\n",
       "      <th>education</th>\n",
       "      <th>education_id</th>\n",
       "      <th>family_status</th>\n",
       "      <th>family_status_id</th>\n",
       "      <th>gender</th>\n",
       "      <th>income_type</th>\n",
       "      <th>debt</th>\n",
       "      <th>total_income</th>\n",
       "      <th>purpose</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>21515</th>\n",
       "      <td>1</td>\n",
       "      <td>-467.685130</td>\n",
       "      <td>28</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>1</td>\n",
       "      <td>109486.327999</td>\n",
       "      <td>заняться образованием</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21516</th>\n",
       "      <td>0</td>\n",
       "      <td>-914.391429</td>\n",
       "      <td>42</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>322807.776603</td>\n",
       "      <td>покупка своего жилья</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21517</th>\n",
       "      <td>0</td>\n",
       "      <td>-404.679034</td>\n",
       "      <td>42</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>178059.553491</td>\n",
       "      <td>на покупку своего автомобиля</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21518</th>\n",
       "      <td>0</td>\n",
       "      <td>373995.710838</td>\n",
       "      <td>59</td>\n",
       "      <td>СРЕДНЕЕ</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>153864.650328</td>\n",
       "      <td>сделка с автомобилем</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21519</th>\n",
       "      <td>1</td>\n",
       "      <td>-2351.431934</td>\n",
       "      <td>37</td>\n",
       "      <td>ученая степень</td>\n",
       "      <td>4</td>\n",
       "      <td>в разводе</td>\n",
       "      <td>3</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>115949.039788</td>\n",
       "      <td>покупка коммерческой недвижимости</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21520</th>\n",
       "      <td>1</td>\n",
       "      <td>-4529.316663</td>\n",
       "      <td>43</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>224791.862382</td>\n",
       "      <td>операции с жильем</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21521</th>\n",
       "      <td>0</td>\n",
       "      <td>343937.404131</td>\n",
       "      <td>67</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>155999.806512</td>\n",
       "      <td>сделка с автомобилем</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21522</th>\n",
       "      <td>1</td>\n",
       "      <td>-2113.346888</td>\n",
       "      <td>38</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>1</td>\n",
       "      <td>89672.561153</td>\n",
       "      <td>недвижимость</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21523</th>\n",
       "      <td>3</td>\n",
       "      <td>-3112.481705</td>\n",
       "      <td>38</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>1</td>\n",
       "      <td>244093.050500</td>\n",
       "      <td>на покупку своего автомобиля</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21524</th>\n",
       "      <td>2</td>\n",
       "      <td>-1984.507589</td>\n",
       "      <td>40</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>82047.418899</td>\n",
       "      <td>на покупку автомобиля</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       children  days_employed  dob_years       education  education_id  \\\n",
       "21515         1    -467.685130         28         среднее             1   \n",
       "21516         0    -914.391429         42          высшее             0   \n",
       "21517         0    -404.679034         42          высшее             0   \n",
       "21518         0  373995.710838         59         СРЕДНЕЕ             1   \n",
       "21519         1   -2351.431934         37  ученая степень             4   \n",
       "21520         1   -4529.316663         43         среднее             1   \n",
       "21521         0  343937.404131         67         среднее             1   \n",
       "21522         1   -2113.346888         38         среднее             1   \n",
       "21523         3   -3112.481705         38         среднее             1   \n",
       "21524         2   -1984.507589         40         среднее             1   \n",
       "\n",
       "          family_status  family_status_id gender income_type  debt  \\\n",
       "21515   женат / замужем                 0      F   сотрудник     1   \n",
       "21516   женат / замужем                 0      F   компаньон     0   \n",
       "21517  гражданский брак                 1      F   компаньон     0   \n",
       "21518   женат / замужем                 0      F   пенсионер     0   \n",
       "21519         в разводе                 3      M   сотрудник     0   \n",
       "21520  гражданский брак                 1      F   компаньон     0   \n",
       "21521   женат / замужем                 0      F   пенсионер     0   \n",
       "21522  гражданский брак                 1      M   сотрудник     1   \n",
       "21523   женат / замужем                 0      M   сотрудник     1   \n",
       "21524   женат / замужем                 0      F   сотрудник     0   \n",
       "\n",
       "        total_income                            purpose  \n",
       "21515  109486.327999              заняться образованием  \n",
       "21516  322807.776603               покупка своего жилья  \n",
       "21517  178059.553491       на покупку своего автомобиля  \n",
       "21518  153864.650328               сделка с автомобилем  \n",
       "21519  115949.039788  покупка коммерческой недвижимости  \n",
       "21520  224791.862382                  операции с жильем  \n",
       "21521  155999.806512               сделка с автомобилем  \n",
       "21522   89672.561153                       недвижимость  \n",
       "21523  244093.050500       на покупку своего автомобиля  \n",
       "21524   82047.418899              на покупку автомобиля  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks.tail(10)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Посмотрим на отдельные столбцы таблицы для выявления аномальных значений"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "-1        47\n",
       " 0     14149\n",
       " 1      4818\n",
       " 2      2055\n",
       " 3       330\n",
       " 4        41\n",
       " 5         9\n",
       " 20       76\n",
       "Name: children, dtype: int64"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['children'].value_counts().sort_index()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0     101\n",
       "19     14\n",
       "20     51\n",
       "21    111\n",
       "22    183\n",
       "23    254\n",
       "24    264\n",
       "25    357\n",
       "26    408\n",
       "27    493\n",
       "28    503\n",
       "29    545\n",
       "30    540\n",
       "31    560\n",
       "32    510\n",
       "33    581\n",
       "34    603\n",
       "35    617\n",
       "36    555\n",
       "37    537\n",
       "38    598\n",
       "39    573\n",
       "40    609\n",
       "41    607\n",
       "42    597\n",
       "43    513\n",
       "44    547\n",
       "45    497\n",
       "46    475\n",
       "47    480\n",
       "48    538\n",
       "49    508\n",
       "50    514\n",
       "51    448\n",
       "52    484\n",
       "53    459\n",
       "54    479\n",
       "55    443\n",
       "56    487\n",
       "57    460\n",
       "58    461\n",
       "59    444\n",
       "60    377\n",
       "61    355\n",
       "62    352\n",
       "63    269\n",
       "64    265\n",
       "65    194\n",
       "66    183\n",
       "67    167\n",
       "68     99\n",
       "69     85\n",
       "70     65\n",
       "71     58\n",
       "72     33\n",
       "73      8\n",
       "74      6\n",
       "75      1\n",
       "Name: dob_years, dtype: int64"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['dob_years'].value_counts().sort_index()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['высшее', 'среднее', 'Среднее', 'СРЕДНЕЕ', 'ВЫСШЕЕ',\n",
       "       'неоконченное высшее', 'начальное', 'Высшее',\n",
       "       'НЕОКОНЧЕННОЕ ВЫСШЕЕ', 'Неоконченное высшее', 'НАЧАЛЬНОЕ',\n",
       "       'Начальное', 'Ученая степень', 'УЧЕНАЯ СТЕПЕНЬ', 'ученая степень'],\n",
       "      dtype=object)"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['education'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['женат / замужем', 'гражданский брак', 'вдовец / вдова',\n",
       "       'в разводе', 'Не женат / не замужем'], dtype=object)"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['family_status'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "F      14236\n",
       "M       7288\n",
       "XNA        1\n",
       "Name: gender, dtype: int64"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['gender'].value_counts()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['сотрудник', 'пенсионер', 'компаньон', 'госслужащий',\n",
       "       'безработный', 'предприниматель', 'студент', 'в декрете'],\n",
       "      dtype=object)"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['income_type'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([0, 1])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['debt'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['покупка жилья', 'приобретение автомобиля',\n",
       "       'дополнительное образование', 'сыграть свадьбу',\n",
       "       'операции с жильем', 'образование', 'на проведение свадьбы',\n",
       "       'покупка жилья для семьи', 'покупка недвижимости',\n",
       "       'покупка коммерческой недвижимости', 'покупка жилой недвижимости',\n",
       "       'строительство собственной недвижимости', 'недвижимость',\n",
       "       'строительство недвижимости', 'на покупку подержанного автомобиля',\n",
       "       'на покупку своего автомобиля',\n",
       "       'операции с коммерческой недвижимостью',\n",
       "       'строительство жилой недвижимости', 'жилье',\n",
       "       'операции со своей недвижимостью', 'автомобили',\n",
       "       'заняться образованием', 'сделка с подержанным автомобилем',\n",
       "       'получение образования', 'автомобиль', 'свадьба',\n",
       "       'получение дополнительного образования', 'покупка своего жилья',\n",
       "       'операции с недвижимостью', 'получение высшего образования',\n",
       "       'свой автомобиль', 'сделка с автомобилем',\n",
       "       'профильное образование', 'высшее образование',\n",
       "       'покупка жилья для сдачи', 'на покупку автомобиля', 'ремонт жилью',\n",
       "       'заняться высшим образованием'], dtype=object)"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['purpose'].unique()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "    - Датасет состоит из 21525 строк.\n",
    "    - В столбцах days_employed, total_income есть 2 174 пропущенных значений. Можно сделать предположение, что эти клиенты не предоставили информацию о своём месте работе и доходах, т.е работают не официально или вообще не работают. Такого рода клиенты относятся к категории высокого риска для банка. Так как в рамках данного исследования столбец total_income нужен для ответа на вопрос \"Есть ли зависимость между уровнем дохода и возвратом кредита в срок?\", то необходимо обработать эти пропуски.\n",
    "    - Отмечаем, что столбцы days_employed, total_income в формате float. Для удобства в дальнейшем переведем их в тип Int.\n",
    "    - Столбцец children: аномальные значение -1 и 20. -1 заменим на 1, 20 на 2 - предположительно ошибка в данных.\n",
    "    - Столбец days_employed: Отрицательные значения - переведем в положительные. Максимальное значение в столбце соответствует 1100 лет работы, что явно являтеся ошибкой в данных, но на текущее исследование не влияет.\n",
    "    - Стобец dob_years: У 101 одного человека возраст 0. Возьмём на заметку, в данном случае на вопросы исследования не влияет.\n",
    "    - Стобец education: Есть записи в верхнем регистре - переведём в нижний.\n",
    "    - Столбец family_status: Есть записи в верхнем регистре - переведём в нижний.\n",
    "    - Стобец gender: 1 клиент с неизвестным полом. На исследование не влияет.\n",
    "    - Столбец total_income: Переведем в целочисленный тип данных. Посмотрим на предмет аномальных значений.  \n",
    "    - Столбец purpose: Есть разные формулировки одних и тех же целей кредита - применим лемматизацию."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Молодец, датафрейм осмотрел и сформулировал подходящие выводы\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Шаг 2. Предобработка данных"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Обработка пропусков"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "children               0\n",
       "days_employed       2174\n",
       "dob_years              0\n",
       "education              0\n",
       "education_id           0\n",
       "family_status          0\n",
       "family_status_id       0\n",
       "gender                 0\n",
       "income_type            0\n",
       "debt                   0\n",
       "total_income        2174\n",
       "purpose                0\n",
       "dtype: int64"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Подсчитаем суммарное количество пропусков\n",
    "ks.isnull().sum()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Есть одинаковое колличество пропущенных значений в двух столбцах.\n",
    "Посмотрим подробнее на характер пропущенных значений."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>children</th>\n",
       "      <th>days_employed</th>\n",
       "      <th>dob_years</th>\n",
       "      <th>education</th>\n",
       "      <th>education_id</th>\n",
       "      <th>family_status</th>\n",
       "      <th>family_status_id</th>\n",
       "      <th>gender</th>\n",
       "      <th>income_type</th>\n",
       "      <th>debt</th>\n",
       "      <th>total_income</th>\n",
       "      <th>purpose</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>65</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>M</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>сыграть свадьбу</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>41</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>госслужащий</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>образование</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>63</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>Не женат / не замужем</td>\n",
       "      <td>4</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>строительство жилой недвижимости</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>41</th>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>50</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>госслужащий</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>сделка с подержанным автомобилем</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55</th>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>54</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>сыграть свадьбу</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>65</th>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>21</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>Не женат / не замужем</td>\n",
       "      <td>4</td>\n",
       "      <td>M</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>операции с коммерческой недвижимостью</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>67</th>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>52</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>покупка жилья для семьи</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>72</th>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>32</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>госслужащий</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>операции с коммерческой недвижимостью</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>82</th>\n",
       "      <td>2</td>\n",
       "      <td>NaN</td>\n",
       "      <td>50</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>жилье</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>83</th>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>52</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>жилье</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    children  days_employed  dob_years education  education_id  \\\n",
       "12         0            NaN         65   среднее             1   \n",
       "26         0            NaN         41   среднее             1   \n",
       "29         0            NaN         63   среднее             1   \n",
       "41         0            NaN         50   среднее             1   \n",
       "55         0            NaN         54   среднее             1   \n",
       "65         0            NaN         21   среднее             1   \n",
       "67         0            NaN         52    высшее             0   \n",
       "72         1            NaN         32    высшее             0   \n",
       "82         2            NaN         50    высшее             0   \n",
       "83         0            NaN         52   среднее             1   \n",
       "\n",
       "            family_status  family_status_id gender  income_type  debt  \\\n",
       "12       гражданский брак                 1      M    пенсионер     0   \n",
       "26        женат / замужем                 0      M  госслужащий     0   \n",
       "29  Не женат / не замужем                 4      F    пенсионер     0   \n",
       "41        женат / замужем                 0      F  госслужащий     0   \n",
       "55       гражданский брак                 1      F    пенсионер     1   \n",
       "65  Не женат / не замужем                 4      M    компаньон     0   \n",
       "67        женат / замужем                 0      F    пенсионер     0   \n",
       "72        женат / замужем                 0      M  госслужащий     0   \n",
       "82        женат / замужем                 0      F    сотрудник     0   \n",
       "83        женат / замужем                 0      M    сотрудник     0   \n",
       "\n",
       "    total_income                                purpose  \n",
       "12           NaN                        сыграть свадьбу  \n",
       "26           NaN                            образование  \n",
       "29           NaN       строительство жилой недвижимости  \n",
       "41           NaN       сделка с подержанным автомобилем  \n",
       "55           NaN                        сыграть свадьбу  \n",
       "65           NaN  операции с коммерческой недвижимостью  \n",
       "67           NaN                покупка жилья для семьи  \n",
       "72           NaN  операции с коммерческой недвижимостью  \n",
       "82           NaN                                  жилье  \n",
       "83           NaN                                  жилье  "
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks[ks['total_income'].isnull()].head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "income_type\n",
       "госслужащий         147\n",
       "компаньон           508\n",
       "пенсионер           413\n",
       "предприниматель       1\n",
       "сотрудник          1105\n",
       "Name: debt, dtype: int64"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks[ks['total_income'].isnull()].groupby('income_type')['debt'].count()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "education\n",
       "ВЫСШЕЕ                   23\n",
       "Высшее                   25\n",
       "НАЧАЛЬНОЕ                 1\n",
       "НЕОКОНЧЕННОЕ ВЫСШЕЕ       7\n",
       "Начальное                 1\n",
       "Неоконченное высшее       7\n",
       "СРЕДНЕЕ                  67\n",
       "Среднее                  65\n",
       "высшее                  496\n",
       "начальное                19\n",
       "неоконченное высшее      55\n",
       "среднее                1408\n",
       "Name: debt, dtype: int64"
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks[ks['total_income'].isnull()].groupby('education')['debt'].count()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "dob_years\n",
       "0     10\n",
       "19     1\n",
       "20     5\n",
       "21    18\n",
       "22    17\n",
       "23    36\n",
       "24    21\n",
       "25    23\n",
       "26    35\n",
       "27    36\n",
       "28    57\n",
       "29    50\n",
       "30    58\n",
       "31    65\n",
       "32    37\n",
       "33    51\n",
       "34    69\n",
       "35    64\n",
       "36    63\n",
       "37    53\n",
       "38    54\n",
       "39    51\n",
       "40    66\n",
       "41    59\n",
       "42    65\n",
       "43    50\n",
       "44    44\n",
       "45    50\n",
       "46    48\n",
       "47    59\n",
       "48    46\n",
       "49    50\n",
       "50    51\n",
       "51    50\n",
       "52    53\n",
       "53    44\n",
       "54    55\n",
       "55    48\n",
       "56    54\n",
       "57    56\n",
       "58    56\n",
       "59    34\n",
       "60    39\n",
       "61    38\n",
       "62    38\n",
       "63    29\n",
       "64    37\n",
       "65    20\n",
       "66    20\n",
       "67    16\n",
       "68     9\n",
       "69     5\n",
       "70     3\n",
       "71     5\n",
       "72     2\n",
       "73     1\n",
       "Name: debt, dtype: int64"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks[ks['total_income'].isnull()].groupby('dob_years')['debt'].count()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Видим, что пропущены значения разных категорий заёмщиков. Скорее всего пропуски имеют технический характер.  \n",
    "Вариант с тем, что заёмщики вообще не работали или не предоставили документы о трудовом стаже и доходах маловероятен, так как в этом случае должна быть отдельная отметка в данных или модель построения кредитного скорринга.   \n",
    "Всего пропущено около **10%** значений - оптимальным решением было бы запросить информацию о причинах пропущенных значений у заказчика.  \n",
    "В рамках исследования столбец total_income нужен для ответа на вопрос \"Есть ли зависимость между уровнем дохода и возвратом кредита в срок?\"  \n",
    "Мы не можем однозначно установить причину, поэтому есть 2 варианта решения проблемы:  \n",
    "1) Заменить пропущенные значение на \"0\" и не учитывать их при ответе на вопрос.  \n",
    "2) Заменить на медианные значения в зависимости от уровня образования и типа занятости.  \n",
    "Воспользуемся 2 вариантом так как более вероятна техническая ошибка и терять 10% датасета нецелесообразно.   \n",
    "Для ответа на остальные вопросы столбцы days_employed, total_income не требуются."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "education_id  income_type    \n",
       "0             безработный        202722.511368\n",
       "              госслужащий        172511.107016\n",
       "              компаньон          201785.400018\n",
       "              пенсионер          144240.768611\n",
       "              предприниматель    499163.144947\n",
       "              сотрудник          165640.744634\n",
       "              студент             98201.625314\n",
       "1             безработный         59956.991984\n",
       "              в декрете           53829.130729\n",
       "              госслужащий        136652.970357\n",
       "              компаньон          159070.690289\n",
       "              пенсионер          114842.854099\n",
       "              сотрудник          136555.108821\n",
       "2             госслужащий        160592.345303\n",
       "              компаньон          179867.152890\n",
       "              пенсионер          120136.896353\n",
       "              сотрудник          151308.937846\n",
       "3             госслужащий        148339.290825\n",
       "              компаньон          136798.905143\n",
       "              пенсионер          102598.653164\n",
       "              сотрудник          125994.910603\n",
       "4             госслужащий        111392.231107\n",
       "              пенсионер          177088.845999\n",
       "              сотрудник          198570.757322\n",
       "Name: total_income, dtype: float64"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Найдём медианные значения по столбцам 'education_id','income_type' через группировку и составим \"словарь\"\n",
    "median_gr_ti = ks.groupby(['education_id','income_type'])['total_income'].median()\n",
    "median_gr_ti"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Составим функцию для возврата медианного значения из словаря\n",
    "def fill_total_income(row):\n",
    "    return median_gr_ti.loc[row['education_id']][row['income_type']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Вызываем функцию, на вход передаём строки из таблицы с нулевыми значениями в столбец total_income\n",
    "ks.loc[ks['total_income'].isnull(),'total_income'] = ks.apply(fill_total_income, axis=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "education_id  income_type    \n",
       "0             безработный        395302.838654\n",
       "              госслужащий         -2531.034209\n",
       "              компаньон           -1454.659104\n",
       "              пенсионер          366158.526428\n",
       "              предприниматель      -520.848083\n",
       "              сотрудник           -1556.457266\n",
       "              студент              -578.751554\n",
       "1             безработный        337524.466835\n",
       "              в декрете           -3296.759962\n",
       "              госслужащий         -2857.770974\n",
       "              компаньон           -1670.809068\n",
       "              пенсионер          365025.338867\n",
       "              сотрудник           -1613.581420\n",
       "2             госслужащий         -1885.183639\n",
       "              компаньон           -1017.888120\n",
       "              пенсионер          372250.501660\n",
       "              сотрудник           -1197.676879\n",
       "3             госслужащий         -2787.767403\n",
       "              компаньон           -1151.634460\n",
       "              пенсионер          360264.985350\n",
       "              сотрудник           -1197.176853\n",
       "4             госслужащий         -5968.075884\n",
       "              пенсионер          356930.517546\n",
       "              сотрудник           -2351.431934\n",
       "Name: days_employed, dtype: float64"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Для исследования не требуется, но проделаем теже действия со столбцом days_employed\n",
    "median_gr_de = ks.groupby(['education_id','income_type'])['days_employed'].median()\n",
    "median_gr_de"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [],
   "source": [
    "def fill_days_employed(row):\n",
    "    return median_gr_de.loc[row['education_id']][row['income_type']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [],
   "source": [
    "ks.loc[ks['days_employed'].isnull(),'days_employed'] = ks.apply(fill_days_employed, axis=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "children            0\n",
       "days_employed       0\n",
       "dob_years           0\n",
       "education           0\n",
       "education_id        0\n",
       "family_status       0\n",
       "family_status_id    0\n",
       "gender              0\n",
       "income_type         0\n",
       "debt                0\n",
       "total_income        0\n",
       "purpose             0\n",
       "dtype: int64"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Все нулевые значения заменены\n",
    "ks.isnull().sum()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Молодец, хороший подход для заполнения пропусков!\n",
    "    \n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "children                           0\n",
       "days_employed                 365025\n",
       "dob_years                         65\n",
       "education                    среднее\n",
       "education_id                       1\n",
       "family_status       гражданский брак\n",
       "family_status_id                   1\n",
       "gender                             M\n",
       "income_type                пенсионер\n",
       "debt                               0\n",
       "total_income                  114843\n",
       "purpose              сыграть свадьбу\n",
       "Name: 12, dtype: object"
      ]
     },
     "execution_count": 27,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Проверим выведя первую строку, которая была с нулями.\n",
    "ks.loc[12]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Теперь посмотрим на предмет аномальных значений."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>count</th>\n",
       "      <th>median</th>\n",
       "      <th>mean</th>\n",
       "      <th>max</th>\n",
       "      <th>min</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>income_type</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>безработный</th>\n",
       "      <td>2</td>\n",
       "      <td>131339.751676</td>\n",
       "      <td>131339.751676</td>\n",
       "      <td>2.027225e+05</td>\n",
       "      <td>59956.991984</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>в декрете</th>\n",
       "      <td>1</td>\n",
       "      <td>53829.130729</td>\n",
       "      <td>53829.130729</td>\n",
       "      <td>5.382913e+04</td>\n",
       "      <td>53829.130729</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>госслужащий</th>\n",
       "      <td>1459</td>\n",
       "      <td>148978.800029</td>\n",
       "      <td>169086.211531</td>\n",
       "      <td>9.104515e+05</td>\n",
       "      <td>29200.077193</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>компаньон</th>\n",
       "      <td>5085</td>\n",
       "      <td>170155.716801</td>\n",
       "      <td>199743.688235</td>\n",
       "      <td>2.265604e+06</td>\n",
       "      <td>28702.812889</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>пенсионер</th>\n",
       "      <td>3856</td>\n",
       "      <td>114842.854099</td>\n",
       "      <td>135164.404380</td>\n",
       "      <td>7.351033e+05</td>\n",
       "      <td>20667.263793</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>предприниматель</th>\n",
       "      <td>2</td>\n",
       "      <td>499163.144947</td>\n",
       "      <td>499163.144947</td>\n",
       "      <td>4.991631e+05</td>\n",
       "      <td>499163.144947</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>сотрудник</th>\n",
       "      <td>11119</td>\n",
       "      <td>138068.631966</td>\n",
       "      <td>159568.189866</td>\n",
       "      <td>1.726276e+06</td>\n",
       "      <td>21367.648356</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>студент</th>\n",
       "      <td>1</td>\n",
       "      <td>98201.625314</td>\n",
       "      <td>98201.625314</td>\n",
       "      <td>9.820163e+04</td>\n",
       "      <td>98201.625314</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                 count         median           mean           max  \\\n",
       "income_type                                                          \n",
       "безработный          2  131339.751676  131339.751676  2.027225e+05   \n",
       "в декрете            1   53829.130729   53829.130729  5.382913e+04   \n",
       "госслужащий       1459  148978.800029  169086.211531  9.104515e+05   \n",
       "компаньон         5085  170155.716801  199743.688235  2.265604e+06   \n",
       "пенсионер         3856  114842.854099  135164.404380  7.351033e+05   \n",
       "предприниматель      2  499163.144947  499163.144947  4.991631e+05   \n",
       "сотрудник        11119  138068.631966  159568.189866  1.726276e+06   \n",
       "студент              1   98201.625314   98201.625314  9.820163e+04   \n",
       "\n",
       "                           min  \n",
       "income_type                     \n",
       "безработный       59956.991984  \n",
       "в декрете         53829.130729  \n",
       "госслужащий       29200.077193  \n",
       "компаньон         28702.812889  \n",
       "пенсионер         20667.263793  \n",
       "предприниматель  499163.144947  \n",
       "сотрудник         21367.648356  \n",
       "студент           98201.625314  "
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Проверим столбец на предмет \"аномальных\" значений.\n",
    "ks.groupby('income_type')['total_income'].agg(['count','median','mean','max','min'])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Есть достаточно существенная разница между средним и медианой, что говорит об аномалиях."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>children</th>\n",
       "      <th>days_employed</th>\n",
       "      <th>dob_years</th>\n",
       "      <th>education</th>\n",
       "      <th>education_id</th>\n",
       "      <th>family_status</th>\n",
       "      <th>family_status_id</th>\n",
       "      <th>gender</th>\n",
       "      <th>income_type</th>\n",
       "      <th>debt</th>\n",
       "      <th>total_income</th>\n",
       "      <th>purpose</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>12412</th>\n",
       "      <td>0</td>\n",
       "      <td>-1477.438114</td>\n",
       "      <td>44</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>2.265604e+06</td>\n",
       "      <td>ремонт жилью</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19606</th>\n",
       "      <td>1</td>\n",
       "      <td>-2577.664662</td>\n",
       "      <td>39</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>1</td>\n",
       "      <td>2.200852e+06</td>\n",
       "      <td>строительство недвижимости</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9169</th>\n",
       "      <td>1</td>\n",
       "      <td>-5248.554336</td>\n",
       "      <td>35</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>1.726276e+06</td>\n",
       "      <td>дополнительное образование</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20809</th>\n",
       "      <td>0</td>\n",
       "      <td>-4719.273476</td>\n",
       "      <td>61</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>Не женат / не замужем</td>\n",
       "      <td>4</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>1.715018e+06</td>\n",
       "      <td>покупка жилья для семьи</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17178</th>\n",
       "      <td>0</td>\n",
       "      <td>-5734.127087</td>\n",
       "      <td>42</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>M</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>1.711309e+06</td>\n",
       "      <td>сыграть свадьбу</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17503</th>\n",
       "      <td>0</td>\n",
       "      <td>-2285.476482</td>\n",
       "      <td>43</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>1.597613e+06</td>\n",
       "      <td>операции с недвижимостью</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18368</th>\n",
       "      <td>1</td>\n",
       "      <td>-333.935516</td>\n",
       "      <td>41</td>\n",
       "      <td>ВЫСШЕЕ</td>\n",
       "      <td>0</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>M</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>1.551153e+06</td>\n",
       "      <td>свадьба</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18353</th>\n",
       "      <td>1</td>\n",
       "      <td>-3173.282035</td>\n",
       "      <td>41</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>Не женат / не замужем</td>\n",
       "      <td>4</td>\n",
       "      <td>F</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>1.427934e+06</td>\n",
       "      <td>автомобиль</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15268</th>\n",
       "      <td>1</td>\n",
       "      <td>-10207.448165</td>\n",
       "      <td>64</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>в разводе</td>\n",
       "      <td>3</td>\n",
       "      <td>M</td>\n",
       "      <td>компаньон</td>\n",
       "      <td>0</td>\n",
       "      <td>1.350246e+06</td>\n",
       "      <td>жилье</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11071</th>\n",
       "      <td>1</td>\n",
       "      <td>-1851.200013</td>\n",
       "      <td>36</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>1.286281e+06</td>\n",
       "      <td>покупка коммерческой недвижимости</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       children  days_employed  dob_years education  education_id  \\\n",
       "12412         0   -1477.438114         44    высшее             0   \n",
       "19606         1   -2577.664662         39    высшее             0   \n",
       "9169          1   -5248.554336         35   среднее             1   \n",
       "20809         0   -4719.273476         61   среднее             1   \n",
       "17178         0   -5734.127087         42    высшее             0   \n",
       "17503         0   -2285.476482         43   среднее             1   \n",
       "18368         1    -333.935516         41    ВЫСШЕЕ             0   \n",
       "18353         1   -3173.282035         41    высшее             0   \n",
       "15268         1  -10207.448165         64    высшее             0   \n",
       "11071         1   -1851.200013         36    высшее             0   \n",
       "\n",
       "               family_status  family_status_id gender income_type  debt  \\\n",
       "12412        женат / замужем                 0      M   компаньон     0   \n",
       "19606        женат / замужем                 0      M   компаньон     1   \n",
       "9169        гражданский брак                 1      M   сотрудник     0   \n",
       "20809  Не женат / не замужем                 4      F   сотрудник     0   \n",
       "17178       гражданский брак                 1      M   компаньон     0   \n",
       "17503        женат / замужем                 0      M   компаньон     0   \n",
       "18368       гражданский брак                 1      M   компаньон     0   \n",
       "18353  Не женат / не замужем                 4      F   компаньон     0   \n",
       "15268              в разводе                 3      M   компаньон     0   \n",
       "11071       гражданский брак                 1      F   сотрудник     0   \n",
       "\n",
       "       total_income                            purpose  \n",
       "12412  2.265604e+06                       ремонт жилью  \n",
       "19606  2.200852e+06         строительство недвижимости  \n",
       "9169   1.726276e+06         дополнительное образование  \n",
       "20809  1.715018e+06            покупка жилья для семьи  \n",
       "17178  1.711309e+06                    сыграть свадьбу  \n",
       "17503  1.597613e+06           операции с недвижимостью  \n",
       "18368  1.551153e+06                            свадьба  \n",
       "18353  1.427934e+06                         автомобиль  \n",
       "15268  1.350246e+06                              жилье  \n",
       "11071  1.286281e+06  покупка коммерческой недвижимости  "
      ]
     },
     "execution_count": 29,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Посмотри на этих клиентов\n",
    "ks[(ks['total_income'] > 500000)].sort_values('total_income',ascending=False).head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "children            222\n",
       "days_employed       222\n",
       "dob_years           222\n",
       "education           222\n",
       "education_id        222\n",
       "family_status       222\n",
       "family_status_id    222\n",
       "gender              222\n",
       "income_type         222\n",
       "debt                222\n",
       "total_income        222\n",
       "purpose             222\n",
       "dtype: int64"
      ]
     },
     "execution_count": 30,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Посмотрим на колличество клиентов с доходом свыше 500т.руб в месяц\n",
    "ks[(ks['total_income'] > 500000)].count()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "income_type\n",
       "госслужащий    0.000000\n",
       "компаньон      0.068966\n",
       "пенсионер      0.000000\n",
       "сотрудник      0.082192\n",
       "Name: debt, dtype: float64"
      ]
     },
     "execution_count": 31,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "z=ks[(ks['total_income'] > 500000)]\n",
    "z.groupby('income_type')['debt'].mean()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Весьма вероятно сверхвысокие показатели дохода также являются технической ошибкой, возможно не там стоит запятая.\n",
    "Также как с пропусками однозначно утверждать на основании имеющихся данных мы не можем.  \n",
    "Таких значений около **1%**, поэтому оставим их как есть."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "    \n",
    "Госслужащий, компаньон и сотрудник вполне могут зарабатывать больше 500\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Мы избавились от пропусков, оставив только необходимые для будущего анализа данные."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Молодец, но:\n",
    "    \n",
    "* стоило поработать с нулевым возрастом, это маркер неявного пропуска\n",
    "\n",
    "* значением XNA по полу\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<font color='blue'> Отлично - избавились от пропусков.</font>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Замена типа данных"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Производим замену типа данных на целочисленный, а также обработаем аномальные значение и проблемы с регистром."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "54"
      ]
     },
     "execution_count": 32,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Проверим колличество дублей до обработки данных\n",
    "ks.duplicated().sum()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([1, 0, 3, 2, 4, 5])"
      ]
     },
     "execution_count": 33,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# В столбце children заменим значения -1 на 1, 20 на 2. Явно ошибка в данных. \n",
    "# В реальности такого плана ошибки в данных заворачиваются на этапе верификации анкеты.\n",
    "ks['children'] = ks['children'].replace(20, 2)\n",
    "ks['children'] = ks['children'].replace(-1, 1)\n",
    "ks['children'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "count     21525.000000\n",
       "mean      67299.835726\n",
       "std      139401.710546\n",
       "min          24.000000\n",
       "25%        1023.000000\n",
       "50%        1989.000000\n",
       "75%        5347.000000\n",
       "max      401755.000000\n",
       "Name: days_employed, dtype: float64"
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Столбцец days_employed не требуется для ответа на вопросы, но для порядка его также обработаетм.\n",
    "# Избавляемся от отрицательных значений и переводим в целочисленный тип.\n",
    "# Используем метод astype(), так как нам нужен формат int.\n",
    "# Погрешность при переводе не существенна для исследования.\n",
    "ks['days_employed'] = ks['days_employed'].astype('int').abs()\n",
    "ks['days_employed'].describe()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Как уже отмечали ранее максимальное значение 401775/365=1100 лет. В рамках данного исследования не обращаем внимание."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Как вариант, можно было создать новый признак года, куда вносить значение в годах, а если оно превышает возраст клиента, то значение возраст - 18 лет\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['высшее', 'среднее', 'неоконченное высшее', 'начальное',\n",
       "       'ученая степень'], dtype=object)"
      ]
     },
     "execution_count": 35,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Столбец education: Есть записи в верхнем регистре - переведём в нижний.\n",
    "ks['education'] = ks['education'].str.lower()\n",
    "ks['education'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array(['женат / замужем', 'гражданский брак', 'вдовец / вдова',\n",
       "       'в разводе', 'не женат / не замужем'], dtype=object)"
      ]
     },
     "execution_count": 36,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Столбец family_status: Есть запись \"Не женат\" в верхнем регистре - переведём в нижний.\n",
    "ks['family_status'] = ks['family_status'].str.lower()\n",
    "ks['family_status'].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0    253875\n",
       "1    112080\n",
       "2    145885\n",
       "3    267628\n",
       "4    158616\n",
       "Name: total_income, dtype: int64"
      ]
     },
     "execution_count": 37,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Столбец total_income: Переведем в целочисленный тип данных.\n",
    "ks['total_income'] = ks['total_income'].astype('int')\n",
    "ks['total_income'].head(5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 38,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>children</th>\n",
       "      <th>days_employed</th>\n",
       "      <th>dob_years</th>\n",
       "      <th>education</th>\n",
       "      <th>education_id</th>\n",
       "      <th>family_status</th>\n",
       "      <th>family_status_id</th>\n",
       "      <th>gender</th>\n",
       "      <th>income_type</th>\n",
       "      <th>debt</th>\n",
       "      <th>total_income</th>\n",
       "      <th>purpose</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>8437</td>\n",
       "      <td>42</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>253875</td>\n",
       "      <td>покупка жилья</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>4024</td>\n",
       "      <td>36</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>112080</td>\n",
       "      <td>приобретение автомобиля</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>5623</td>\n",
       "      <td>33</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>145885</td>\n",
       "      <td>покупка жилья</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3</td>\n",
       "      <td>4124</td>\n",
       "      <td>32</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>267628</td>\n",
       "      <td>дополнительное образование</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>340266</td>\n",
       "      <td>53</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>158616</td>\n",
       "      <td>сыграть свадьбу</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   children  days_employed  dob_years education  education_id  \\\n",
       "0         1           8437         42    высшее             0   \n",
       "1         1           4024         36   среднее             1   \n",
       "2         0           5623         33   среднее             1   \n",
       "3         3           4124         32   среднее             1   \n",
       "4         0         340266         53   среднее             1   \n",
       "\n",
       "      family_status  family_status_id gender income_type  debt  total_income  \\\n",
       "0   женат / замужем                 0      F   сотрудник     0        253875   \n",
       "1   женат / замужем                 0      F   сотрудник     0        112080   \n",
       "2   женат / замужем                 0      M   сотрудник     0        145885   \n",
       "3   женат / замужем                 0      M   сотрудник     0        267628   \n",
       "4  гражданский брак                 1      F   пенсионер     0        158616   \n",
       "\n",
       "                      purpose  \n",
       "0               покупка жилья  \n",
       "1     приобретение автомобиля  \n",
       "2               покупка жилья  \n",
       "3  дополнительное образование  \n",
       "4             сыграть свадьбу  "
      ]
     },
     "execution_count": 38,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks.head(5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 21525 entries, 0 to 21524\n",
      "Data columns (total 12 columns):\n",
      "children            21525 non-null int64\n",
      "days_employed       21525 non-null int64\n",
      "dob_years           21525 non-null int64\n",
      "education           21525 non-null object\n",
      "education_id        21525 non-null int64\n",
      "family_status       21525 non-null object\n",
      "family_status_id    21525 non-null int64\n",
      "gender              21525 non-null object\n",
      "income_type         21525 non-null object\n",
      "debt                21525 non-null int64\n",
      "total_income        21525 non-null int64\n",
      "purpose             21525 non-null object\n",
      "dtypes: int64(7), object(5)\n",
      "memory usage: 2.0+ MB\n"
     ]
    }
   ],
   "source": [
    "ks.info()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Данные обработаны и готовы для дальнейшего исследования."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Молодец!\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Обработка дубликатов"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "71"
      ]
     },
     "execution_count": 40,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Проверим колличество дубликатов\n",
    "ks.duplicated().sum()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Колличество дубликатов **71**, что составляет менее 1% от общего колличества.  \n",
    "17 из них появились после перевода в нижний регистр, изменения типов данных и обработки аномалий."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0"
      ]
     },
     "execution_count": 41,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Удалим дубли и сбросим индекс\n",
    "ks = ks.drop_duplicates().reset_index(drop=True)\n",
    "ks.duplicated().sum()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Дубликаты удалены.  \n",
    "Можно предположить, что причина появления связана с повторной подачей заявок на кредит.  \n",
    "Также есть небольшая вероятность того, что были удалены данные разных людей так как у нас нет например ФИО клиента для идентификации клиента.  "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Отлично, от дубликатов избавился)\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Лемматизация"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Загрузим необходмую библиотеку\n",
    "from pymystem3 import Mystem\n",
    "m = Mystem()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "['покупка жилья' 'приобретение автомобиля' 'дополнительное образование'\n",
      " 'сыграть свадьбу' 'операции с жильем' 'образование'\n",
      " 'на проведение свадьбы' 'покупка жилья для семьи' 'покупка недвижимости'\n",
      " 'покупка коммерческой недвижимости' 'покупка жилой недвижимости'\n",
      " 'строительство собственной недвижимости' 'недвижимость'\n",
      " 'строительство недвижимости' 'на покупку подержанного автомобиля'\n",
      " 'на покупку своего автомобиля' 'операции с коммерческой недвижимостью'\n",
      " 'строительство жилой недвижимости' 'жилье'\n",
      " 'операции со своей недвижимостью' 'автомобили' 'заняться образованием'\n",
      " 'сделка с подержанным автомобилем' 'получение образования' 'автомобиль'\n",
      " 'свадьба' 'получение дополнительного образования' 'покупка своего жилья'\n",
      " 'операции с недвижимостью' 'получение высшего образования'\n",
      " 'свой автомобиль' 'сделка с автомобилем' 'профильное образование'\n",
      " 'высшее образование' 'покупка жилья для сдачи' 'на покупку автомобиля'\n",
      " 'ремонт жилью' 'заняться высшим образованием']\n"
     ]
    }
   ],
   "source": [
    "# Посмотрим на уникальные значения столбца purpose\n",
    "unique_credit_purposes = ks['purpose'].unique()\n",
    "print(unique_credit_purposes)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Counter({' ': 33570, '\\n': 21454, 'недвижимость': 6351, 'покупка': 5897, 'жилье': 4460, 'автомобиль': 4306, 'образование': 4013, 'с': 2918, 'операция': 2604, 'свадьба': 2324, 'свой': 2230, 'на': 2222, 'строительство': 1878, 'высокий': 1374, 'получение': 1314, 'коммерческий': 1311, 'для': 1289, 'жилой': 1230, 'сделка': 941, 'дополнительный': 906, 'заниматься': 904, 'проведение': 768, 'сыграть': 765, 'сдача': 651, 'семья': 638, 'собственный': 635, 'со': 627, 'ремонт': 607, 'подержанный': 486, 'подержать': 478, 'приобретение': 461, 'профильный': 436})\n"
     ]
    }
   ],
   "source": [
    "# Проходим по столбцу purpose, выделяем леммы и делаем подсчёт уникальных лемматизированных слов.\n",
    "from collections import Counter\n",
    "lem_purposes = []\n",
    "for p in ks['purpose']:\n",
    "    lem_purposes +=m.lemmatize(p)\n",
    "print(Counter(lem_purposes)) "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Сохраним основные леммы целей получение кредита.\n",
    "purpose_cat = [\n",
    "    'свадьба',\n",
    "    'недвижимость',\n",
    "    'жилье',\n",
    "    'автомобиль',\n",
    "    'образование'\n",
    "]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Лемматизация целей получения кредита проведена.  \n",
    "Если отбросить пробелы и прочие общие слова, можно выделить следующие леммы в получение кредита:  \n",
    "    - недвижимость\n",
    "    - жилье\n",
    "    - автомобиль\n",
    "    - образование\n",
    "    - свадьба"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Молодец, лемматризацию провел хорошо, наиболее популярные цели выделены верно\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Категоризация данных"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "##### Для ответа на поставленные вопросы проведём дополнительную категоризацию данных"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "**•\tЕсть ли зависимость между наличием детей и возвратом кредита в срок?**"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0    14091\n",
       "1     4855\n",
       "2     2128\n",
       "3      330\n",
       "4       41\n",
       "5        9\n",
       "Name: children, dtype: int64"
      ]
     },
     "execution_count": 46,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Посмотрим ещё раз на колличество клиентов в каждой категории\n",
    "ks['children'].value_counts().sort_index()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Видим, что больше всего клиентов у которых нет детей.\n",
    "Разделим клиентов на 2 категории:  \n",
    "**\"Нет детей\"**  \n",
    "**\"Есть дети\"**"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Нет детей\n",
      "Есть дети\n"
     ]
    }
   ],
   "source": [
    "# Напишем соответсвующую функцию\n",
    "def kids_group(count):\n",
    "    if count == 0:\n",
    "        return 'Нет детей'\n",
    "    return 'Есть дети'\n",
    "# Протестируем\n",
    "print(kids_group(0))\n",
    "print(kids_group(1))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 48,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Добавим в таблицу новый столбец\n",
    "ks['kids'] = ks['children'].apply(kids_group)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>children</th>\n",
       "      <th>days_employed</th>\n",
       "      <th>dob_years</th>\n",
       "      <th>education</th>\n",
       "      <th>education_id</th>\n",
       "      <th>family_status</th>\n",
       "      <th>family_status_id</th>\n",
       "      <th>gender</th>\n",
       "      <th>income_type</th>\n",
       "      <th>debt</th>\n",
       "      <th>total_income</th>\n",
       "      <th>purpose</th>\n",
       "      <th>kids</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>8437</td>\n",
       "      <td>42</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>253875</td>\n",
       "      <td>покупка жилья</td>\n",
       "      <td>Есть дети</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>4024</td>\n",
       "      <td>36</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>112080</td>\n",
       "      <td>приобретение автомобиля</td>\n",
       "      <td>Есть дети</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>5623</td>\n",
       "      <td>33</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>145885</td>\n",
       "      <td>покупка жилья</td>\n",
       "      <td>Нет детей</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3</td>\n",
       "      <td>4124</td>\n",
       "      <td>32</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>267628</td>\n",
       "      <td>дополнительное образование</td>\n",
       "      <td>Есть дети</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>340266</td>\n",
       "      <td>53</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>158616</td>\n",
       "      <td>сыграть свадьбу</td>\n",
       "      <td>Нет детей</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   children  days_employed  dob_years education  education_id  \\\n",
       "0         1           8437         42    высшее             0   \n",
       "1         1           4024         36   среднее             1   \n",
       "2         0           5623         33   среднее             1   \n",
       "3         3           4124         32   среднее             1   \n",
       "4         0         340266         53   среднее             1   \n",
       "\n",
       "      family_status  family_status_id gender income_type  debt  total_income  \\\n",
       "0   женат / замужем                 0      F   сотрудник     0        253875   \n",
       "1   женат / замужем                 0      F   сотрудник     0        112080   \n",
       "2   женат / замужем                 0      M   сотрудник     0        145885   \n",
       "3   женат / замужем                 0      M   сотрудник     0        267628   \n",
       "4  гражданский брак                 1      F   пенсионер     0        158616   \n",
       "\n",
       "                      purpose       kids  \n",
       "0               покупка жилья  Есть дети  \n",
       "1     приобретение автомобиля  Есть дети  \n",
       "2               покупка жилья  Нет детей  \n",
       "3  дополнительное образование  Есть дети  \n",
       "4             сыграть свадьбу  Нет детей  "
      ]
     },
     "execution_count": 49,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "**•\tЕсть ли зависимость между семейным положением и возвратом кредита в срок?**"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "женат / замужем          12339\n",
       "гражданский брак          4151\n",
       "не женат / не замужем     2810\n",
       "в разводе                 1195\n",
       "вдовец / вдова             959\n",
       "Name: family_status, dtype: int64"
      ]
     },
     "execution_count": 50,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['family_status'].value_counts()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Будем исходить из логики, что клиенты \"женат / замужем, гражданский брак\" будут выплачивать кредит совместно с созаемищиком.  \n",
    "Клиенты не женат / не замужем,в разводе,вдовец / вдова в одиночку.  \n",
    "Категоризируем клиентов на 2 категории:  \n",
    " - В браке\n",
    " - Не в браке"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "В браке\n",
      "Не в браке\n"
     ]
    }
   ],
   "source": [
    "# Напишем соответсвующую функцию\n",
    "def cat_famstat(categ):\n",
    "    if (categ == 'женат / замужем') or (categ == 'гражданский брак'):\n",
    "        return 'В браке'\n",
    "    return 'Не в браке'\n",
    "# Протестируем\n",
    "print(cat_famstat('женат / замужем'))\n",
    "print(cat_famstat('вдовец / вдова'))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Добавим в таблицу новый столбец\n",
    "ks['family_status_category'] = ks['family_status'].apply(cat_famstat)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>children</th>\n",
       "      <th>days_employed</th>\n",
       "      <th>dob_years</th>\n",
       "      <th>education</th>\n",
       "      <th>education_id</th>\n",
       "      <th>family_status</th>\n",
       "      <th>family_status_id</th>\n",
       "      <th>gender</th>\n",
       "      <th>income_type</th>\n",
       "      <th>debt</th>\n",
       "      <th>total_income</th>\n",
       "      <th>purpose</th>\n",
       "      <th>kids</th>\n",
       "      <th>family_status_category</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>8437</td>\n",
       "      <td>42</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>253875</td>\n",
       "      <td>покупка жилья</td>\n",
       "      <td>Есть дети</td>\n",
       "      <td>В браке</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>4024</td>\n",
       "      <td>36</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>112080</td>\n",
       "      <td>приобретение автомобиля</td>\n",
       "      <td>Есть дети</td>\n",
       "      <td>В браке</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>5623</td>\n",
       "      <td>33</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>145885</td>\n",
       "      <td>покупка жилья</td>\n",
       "      <td>Нет детей</td>\n",
       "      <td>В браке</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3</td>\n",
       "      <td>4124</td>\n",
       "      <td>32</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>267628</td>\n",
       "      <td>дополнительное образование</td>\n",
       "      <td>Есть дети</td>\n",
       "      <td>В браке</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>340266</td>\n",
       "      <td>53</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>158616</td>\n",
       "      <td>сыграть свадьбу</td>\n",
       "      <td>Нет детей</td>\n",
       "      <td>В браке</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   children  days_employed  dob_years education  education_id  \\\n",
       "0         1           8437         42    высшее             0   \n",
       "1         1           4024         36   среднее             1   \n",
       "2         0           5623         33   среднее             1   \n",
       "3         3           4124         32   среднее             1   \n",
       "4         0         340266         53   среднее             1   \n",
       "\n",
       "      family_status  family_status_id gender income_type  debt  total_income  \\\n",
       "0   женат / замужем                 0      F   сотрудник     0        253875   \n",
       "1   женат / замужем                 0      F   сотрудник     0        112080   \n",
       "2   женат / замужем                 0      M   сотрудник     0        145885   \n",
       "3   женат / замужем                 0      M   сотрудник     0        267628   \n",
       "4  гражданский брак                 1      F   пенсионер     0        158616   \n",
       "\n",
       "                      purpose       kids family_status_category  \n",
       "0               покупка жилья  Есть дети                В браке  \n",
       "1     приобретение автомобиля  Есть дети                В браке  \n",
       "2               покупка жилья  Нет детей                В браке  \n",
       "3  дополнительное образование  Есть дети                В браке  \n",
       "4             сыграть свадьбу  Нет детей                В браке  "
      ]
     },
     "execution_count": 53,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "**•\tЕсть ли зависимость между уровнем дохода и возвратом кредита в срок?**"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Категоризируем клиентов на 4 категории в зависимости от уровня дохода.  \n",
    "Разобъём на квантили."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.25    107515.5\n",
       "0.50    143707.5\n",
       "0.75    198307.0\n",
       "Name: total_income, dtype: float64"
      ]
     },
     "execution_count": 54,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['total_income'].quantile([0.25,0.5,0.75])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 55,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Напишем функцию. Клиентам с неизвестным доходом присвоим значение \"Уровень дохода неизвестен\"\n",
    "def income_status(total_income):\n",
    "    if total_income <= 107515.5:\n",
    "            return 'Низкий уровень дохода'\n",
    "    elif total_income <= 143707.5:\n",
    "            return 'Средний уровень дохода'\n",
    "    elif total_income <= 198307.0:\n",
    "            return 'Высокий уровень дохода'      \n",
    "    return 'Сверхвысокий уровень дохода'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 56,
   "metadata": {},
   "outputs": [],
   "source": [
    "ks['income_level'] = ks['total_income'].apply(income_status)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 57,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>children</th>\n",
       "      <th>days_employed</th>\n",
       "      <th>dob_years</th>\n",
       "      <th>education</th>\n",
       "      <th>education_id</th>\n",
       "      <th>family_status</th>\n",
       "      <th>family_status_id</th>\n",
       "      <th>gender</th>\n",
       "      <th>income_type</th>\n",
       "      <th>debt</th>\n",
       "      <th>total_income</th>\n",
       "      <th>purpose</th>\n",
       "      <th>kids</th>\n",
       "      <th>family_status_category</th>\n",
       "      <th>income_level</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>8437</td>\n",
       "      <td>42</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>253875</td>\n",
       "      <td>покупка жилья</td>\n",
       "      <td>Есть дети</td>\n",
       "      <td>В браке</td>\n",
       "      <td>Сверхвысокий уровень дохода</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>4024</td>\n",
       "      <td>36</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>112080</td>\n",
       "      <td>приобретение автомобиля</td>\n",
       "      <td>Есть дети</td>\n",
       "      <td>В браке</td>\n",
       "      <td>Средний уровень дохода</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>5623</td>\n",
       "      <td>33</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>145885</td>\n",
       "      <td>покупка жилья</td>\n",
       "      <td>Нет детей</td>\n",
       "      <td>В браке</td>\n",
       "      <td>Высокий уровень дохода</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3</td>\n",
       "      <td>4124</td>\n",
       "      <td>32</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>267628</td>\n",
       "      <td>дополнительное образование</td>\n",
       "      <td>Есть дети</td>\n",
       "      <td>В браке</td>\n",
       "      <td>Сверхвысокий уровень дохода</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>340266</td>\n",
       "      <td>53</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>158616</td>\n",
       "      <td>сыграть свадьбу</td>\n",
       "      <td>Нет детей</td>\n",
       "      <td>В браке</td>\n",
       "      <td>Высокий уровень дохода</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   children  days_employed  dob_years education  education_id  \\\n",
       "0         1           8437         42    высшее             0   \n",
       "1         1           4024         36   среднее             1   \n",
       "2         0           5623         33   среднее             1   \n",
       "3         3           4124         32   среднее             1   \n",
       "4         0         340266         53   среднее             1   \n",
       "\n",
       "      family_status  family_status_id gender income_type  debt  total_income  \\\n",
       "0   женат / замужем                 0      F   сотрудник     0        253875   \n",
       "1   женат / замужем                 0      F   сотрудник     0        112080   \n",
       "2   женат / замужем                 0      M   сотрудник     0        145885   \n",
       "3   женат / замужем                 0      M   сотрудник     0        267628   \n",
       "4  гражданский брак                 1      F   пенсионер     0        158616   \n",
       "\n",
       "                      purpose       kids family_status_category  \\\n",
       "0               покупка жилья  Есть дети                В браке   \n",
       "1     приобретение автомобиля  Есть дети                В браке   \n",
       "2               покупка жилья  Нет детей                В браке   \n",
       "3  дополнительное образование  Есть дети                В браке   \n",
       "4             сыграть свадьбу  Нет детей                В браке   \n",
       "\n",
       "                  income_level  \n",
       "0  Сверхвысокий уровень дохода  \n",
       "1       Средний уровень дохода  \n",
       "2       Высокий уровень дохода  \n",
       "3  Сверхвысокий уровень дохода  \n",
       "4       Высокий уровень дохода  "
      ]
     },
     "execution_count": 57,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>count</th>\n",
       "      <th>median</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>income_level</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>Высокий уровень дохода</th>\n",
       "      <td>5363</td>\n",
       "      <td>165640.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Низкий уровень дохода</th>\n",
       "      <td>5364</td>\n",
       "      <td>83881.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Сверхвысокий уровень дохода</th>\n",
       "      <td>5364</td>\n",
       "      <td>254276.5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Средний уровень дохода</th>\n",
       "      <td>5363</td>\n",
       "      <td>127955.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                             count    median\n",
       "income_level                                \n",
       "Высокий уровень дохода        5363  165640.0\n",
       "Низкий уровень дохода         5364   83881.0\n",
       "Сверхвысокий уровень дохода   5364  254276.5\n",
       "Средний уровень дохода        5363  127955.0"
      ]
     },
     "execution_count": 58,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks.groupby(['income_level'])['total_income'].agg(['count','median'])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "**•\tКак разные цели кредита влияют на его возврат в срок?**"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Ранее мы уже выделили леммы в целях кредита. Осталось добавить соответствующий столбец.  "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['свадьба', 'недвижимость', 'жилье', 'автомобиль', 'образование']"
      ]
     },
     "execution_count": 59,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Выведем список лемм\n",
    "purpose_cat"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "В наших данных слова встречаются в разном виде, например \"покупка жилья\", \"операции с жильем\".  \n",
    "Можно отбросить окончания, но более правильным будет написать функцию, которая будет лемматизировать строку и сравнивать с нашим списком лемм."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'жилье'"
      ]
     },
     "execution_count": 60,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Пишем функцию, которая возвращает после проверки лемму из списка.\n",
    "def cat_purpose(text):\n",
    "    lemmas = m.lemmatize(text)\n",
    "    for lemma in lemmas:\n",
    "        for category in purpose_cat:\n",
    "            if category in lemma:\n",
    "                return category\n",
    "\n",
    "# Протестируем функцию\n",
    "cat_purpose('покупка жилья')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 61,
   "metadata": {},
   "outputs": [],
   "source": [
    "ks['purpose_cat'] = ks['purpose'].apply(cat_purpose)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 62,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>children</th>\n",
       "      <th>days_employed</th>\n",
       "      <th>dob_years</th>\n",
       "      <th>education</th>\n",
       "      <th>education_id</th>\n",
       "      <th>family_status</th>\n",
       "      <th>family_status_id</th>\n",
       "      <th>gender</th>\n",
       "      <th>income_type</th>\n",
       "      <th>debt</th>\n",
       "      <th>total_income</th>\n",
       "      <th>purpose</th>\n",
       "      <th>kids</th>\n",
       "      <th>family_status_category</th>\n",
       "      <th>income_level</th>\n",
       "      <th>purpose_cat</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>8437</td>\n",
       "      <td>42</td>\n",
       "      <td>высшее</td>\n",
       "      <td>0</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>253875</td>\n",
       "      <td>покупка жилья</td>\n",
       "      <td>Есть дети</td>\n",
       "      <td>В браке</td>\n",
       "      <td>Сверхвысокий уровень дохода</td>\n",
       "      <td>жилье</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>4024</td>\n",
       "      <td>36</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>F</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>112080</td>\n",
       "      <td>приобретение автомобиля</td>\n",
       "      <td>Есть дети</td>\n",
       "      <td>В браке</td>\n",
       "      <td>Средний уровень дохода</td>\n",
       "      <td>автомобиль</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>5623</td>\n",
       "      <td>33</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>145885</td>\n",
       "      <td>покупка жилья</td>\n",
       "      <td>Нет детей</td>\n",
       "      <td>В браке</td>\n",
       "      <td>Высокий уровень дохода</td>\n",
       "      <td>жилье</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3</td>\n",
       "      <td>4124</td>\n",
       "      <td>32</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>женат / замужем</td>\n",
       "      <td>0</td>\n",
       "      <td>M</td>\n",
       "      <td>сотрудник</td>\n",
       "      <td>0</td>\n",
       "      <td>267628</td>\n",
       "      <td>дополнительное образование</td>\n",
       "      <td>Есть дети</td>\n",
       "      <td>В браке</td>\n",
       "      <td>Сверхвысокий уровень дохода</td>\n",
       "      <td>образование</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>340266</td>\n",
       "      <td>53</td>\n",
       "      <td>среднее</td>\n",
       "      <td>1</td>\n",
       "      <td>гражданский брак</td>\n",
       "      <td>1</td>\n",
       "      <td>F</td>\n",
       "      <td>пенсионер</td>\n",
       "      <td>0</td>\n",
       "      <td>158616</td>\n",
       "      <td>сыграть свадьбу</td>\n",
       "      <td>Нет детей</td>\n",
       "      <td>В браке</td>\n",
       "      <td>Высокий уровень дохода</td>\n",
       "      <td>свадьба</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   children  days_employed  dob_years education  education_id  \\\n",
       "0         1           8437         42    высшее             0   \n",
       "1         1           4024         36   среднее             1   \n",
       "2         0           5623         33   среднее             1   \n",
       "3         3           4124         32   среднее             1   \n",
       "4         0         340266         53   среднее             1   \n",
       "\n",
       "      family_status  family_status_id gender income_type  debt  total_income  \\\n",
       "0   женат / замужем                 0      F   сотрудник     0        253875   \n",
       "1   женат / замужем                 0      F   сотрудник     0        112080   \n",
       "2   женат / замужем                 0      M   сотрудник     0        145885   \n",
       "3   женат / замужем                 0      M   сотрудник     0        267628   \n",
       "4  гражданский брак                 1      F   пенсионер     0        158616   \n",
       "\n",
       "                      purpose       kids family_status_category  \\\n",
       "0               покупка жилья  Есть дети                В браке   \n",
       "1     приобретение автомобиля  Есть дети                В браке   \n",
       "2               покупка жилья  Нет детей                В браке   \n",
       "3  дополнительное образование  Есть дети                В браке   \n",
       "4             сыграть свадьбу  Нет детей                В браке   \n",
       "\n",
       "                  income_level  purpose_cat  \n",
       "0  Сверхвысокий уровень дохода        жилье  \n",
       "1       Средний уровень дохода   автомобиль  \n",
       "2       Высокий уровень дохода        жилье  \n",
       "3  Сверхвысокий уровень дохода  образование  \n",
       "4       Высокий уровень дохода      свадьба  "
      ]
     },
     "execution_count": 62,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 63,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "недвижимость    6351\n",
       "жилье           4460\n",
       "автомобиль      4306\n",
       "образование     4013\n",
       "свадьба         2324\n",
       "Name: purpose_cat, dtype: int64"
      ]
     },
     "execution_count": 63,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['purpose_cat'].value_counts()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Мы провели категоризацию данных.  \n",
    "В таблице есть все метрики необходимые для ответа на вопросы заказчика."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Молодец, у тебя хорошие и интересные способы категоризации!\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Шаг 3. Ответьте на вопросы"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Для начала посмотрим на общий процент задолженностей по кредиту."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 64,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0    19713\n",
       "1     1741\n",
       "Name: debt, dtype: int64"
      ]
     },
     "execution_count": 64,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ks['debt'].value_counts()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Всего у нас **21454** клиента."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "8.115036822970076"
      ]
     },
     "execution_count": 65,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "1741/21454*100"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "**8.1%** клиентов имели задолженность по кредитам."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Молодец, что подсчитал, будем сравнивать с этим порогом\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "- Есть ли зависимость между наличием детей и возвратом кредита в срок?"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 66,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style  type=\"text/css\" >\n",
       "    #T_14cffb54_f810_11e9_a7b6_02420a00087drow0_col1 {\n",
       "            background-color :  red;\n",
       "        }</style><table id=\"T_14cffb54_f810_11e9_a7b6_02420a00087d\" ><thead>    <tr>        <th class=\"blank level0\" ></th>        <th class=\"col_heading level0 col0\" >count</th>        <th class=\"col_heading level0 col1\" >mean</th>    </tr>    <tr>        <th class=\"index_name level0\" >kids</th>        <th class=\"blank\" ></th>        <th class=\"blank\" ></th>    </tr></thead><tbody>\n",
       "                <tr>\n",
       "                        <th id=\"T_14cffb54_f810_11e9_a7b6_02420a00087dlevel0_row0\" class=\"row_heading level0 row0\" >Есть дети</th>\n",
       "                        <td id=\"T_14cffb54_f810_11e9_a7b6_02420a00087drow0_col0\" class=\"data row0 col0\" >7363</td>\n",
       "                        <td id=\"T_14cffb54_f810_11e9_a7b6_02420a00087drow0_col1\" class=\"data row0 col1\" >9.2%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14cffb54_f810_11e9_a7b6_02420a00087dlevel0_row1\" class=\"row_heading level0 row1\" >Нет детей</th>\n",
       "                        <td id=\"T_14cffb54_f810_11e9_a7b6_02420a00087drow1_col0\" class=\"data row1 col0\" >14091</td>\n",
       "                        <td id=\"T_14cffb54_f810_11e9_a7b6_02420a00087drow1_col1\" class=\"data row1 col1\" >7.5%</td>\n",
       "            </tr>\n",
       "    </tbody></table>"
      ],
      "text/plain": [
       "<pandas.io.formats.style.Styler at 0x7ffb3d4bad68>"
      ]
     },
     "execution_count": 66,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Сгруппируем данные и посмотрим на процент задолженностей по категориям.  \n",
    "# Выделим цветом, категории где процент выше общего среднего.\n",
    "(ks.groupby(['kids'])['debt']\n",
    ".agg(['count', 'mean'])\n",
    ".sort_values('mean',ascending=False)\n",
    ".style\n",
    ".format({\n",
    "    'mean': '{:,.1%}'.format,\n",
    "})\n",
    ".applymap(\n",
    "     lambda x: 'background-color : red' if x>0.081 else '', \n",
    "     subset=['mean']))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 67,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style  type=\"text/css\" >\n",
       "    #T_14d59834_f810_11e9_a7b6_02420a00087drow0_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_14d59834_f810_11e9_a7b6_02420a00087drow1_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_14d59834_f810_11e9_a7b6_02420a00087drow2_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_14d59834_f810_11e9_a7b6_02420a00087drow3_col1 {\n",
       "            background-color :  red;\n",
       "        }</style><table id=\"T_14d59834_f810_11e9_a7b6_02420a00087d\" ><thead>    <tr>        <th class=\"blank level0\" ></th>        <th class=\"col_heading level0 col0\" >count</th>        <th class=\"col_heading level0 col1\" >mean</th>    </tr>    <tr>        <th class=\"index_name level0\" >children</th>        <th class=\"blank\" ></th>        <th class=\"blank\" ></th>    </tr></thead><tbody>\n",
       "                <tr>\n",
       "                        <th id=\"T_14d59834_f810_11e9_a7b6_02420a00087dlevel0_row0\" class=\"row_heading level0 row0\" >4</th>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow0_col0\" class=\"data row0 col0\" >41</td>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow0_col1\" class=\"data row0 col1\" >9.8%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14d59834_f810_11e9_a7b6_02420a00087dlevel0_row1\" class=\"row_heading level0 row1\" >2</th>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow1_col0\" class=\"data row1 col0\" >2128</td>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow1_col1\" class=\"data row1 col1\" >9.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14d59834_f810_11e9_a7b6_02420a00087dlevel0_row2\" class=\"row_heading level0 row2\" >1</th>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow2_col0\" class=\"data row2 col0\" >4855</td>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow2_col1\" class=\"data row2 col1\" >9.2%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14d59834_f810_11e9_a7b6_02420a00087dlevel0_row3\" class=\"row_heading level0 row3\" >3</th>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow3_col0\" class=\"data row3 col0\" >330</td>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow3_col1\" class=\"data row3 col1\" >8.2%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14d59834_f810_11e9_a7b6_02420a00087dlevel0_row4\" class=\"row_heading level0 row4\" >0</th>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow4_col0\" class=\"data row4 col0\" >14091</td>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow4_col1\" class=\"data row4 col1\" >7.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14d59834_f810_11e9_a7b6_02420a00087dlevel0_row5\" class=\"row_heading level0 row5\" >5</th>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow5_col0\" class=\"data row5 col0\" >9</td>\n",
       "                        <td id=\"T_14d59834_f810_11e9_a7b6_02420a00087drow5_col1\" class=\"data row5 col1\" >0.0%</td>\n",
       "            </tr>\n",
       "    </tbody></table>"
      ],
      "text/plain": [
       "<pandas.io.formats.style.Styler at 0x7ffb3c327358>"
      ]
     },
     "execution_count": 67,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Посмотрим также в разрезе колличества детей.\n",
    "(ks.groupby(['children'])['debt']\n",
    ".agg(['count', 'mean'])\n",
    ".sort_values('mean',ascending=False)\n",
    ".style\n",
    ".format({\n",
    "    'mean': '{:,.1%}'.format,\n",
    "})\n",
    ".applymap(\n",
    "     lambda x: 'background-color : red' if x>0.081 else '', \n",
    "     subset=['mean']))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Наличие детей влияет на наличие задолженностей по кредиту.\n",
    "- **9.2%** клиентов имели задолженность по кредиту, что на 1% больше среднего показателя.\n",
    "  Выбивается показатель для семей с 3-мя детьми, но т.к выборка по ним мала, делать какие-то выводы нецелесообразно.  \n",
    "- Заёмщики без детей реже залезают в долги, всего **7.2%**"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Отлично! Как мы видим дети существенно влияют на возврат кредита\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "- Есть ли зависимость между семейным положением и возвратом кредита в срок?"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 68,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style  type=\"text/css\" >\n",
       "    #T_14da4af0_f810_11e9_a7b6_02420a00087drow0_col1 {\n",
       "            background-color :  red;\n",
       "        }</style><table id=\"T_14da4af0_f810_11e9_a7b6_02420a00087d\" ><thead>    <tr>        <th class=\"blank level0\" ></th>        <th class=\"col_heading level0 col0\" >count</th>        <th class=\"col_heading level0 col1\" >mean</th>    </tr>    <tr>        <th class=\"index_name level0\" >family_status_category</th>        <th class=\"blank\" ></th>        <th class=\"blank\" ></th>    </tr></thead><tbody>\n",
       "                <tr>\n",
       "                        <th id=\"T_14da4af0_f810_11e9_a7b6_02420a00087dlevel0_row0\" class=\"row_heading level0 row0\" >Не в браке</th>\n",
       "                        <td id=\"T_14da4af0_f810_11e9_a7b6_02420a00087drow0_col0\" class=\"data row0 col0\" >4964</td>\n",
       "                        <td id=\"T_14da4af0_f810_11e9_a7b6_02420a00087drow0_col1\" class=\"data row0 col1\" >8.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14da4af0_f810_11e9_a7b6_02420a00087dlevel0_row1\" class=\"row_heading level0 row1\" >В браке</th>\n",
       "                        <td id=\"T_14da4af0_f810_11e9_a7b6_02420a00087drow1_col0\" class=\"data row1 col0\" >16490</td>\n",
       "                        <td id=\"T_14da4af0_f810_11e9_a7b6_02420a00087drow1_col1\" class=\"data row1 col1\" >8.0%</td>\n",
       "            </tr>\n",
       "    </tbody></table>"
      ],
      "text/plain": [
       "<pandas.io.formats.style.Styler at 0x7ffb1e9a2780>"
      ]
     },
     "execution_count": 68,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Сгруппируем данные\n",
    "(ks.groupby(['family_status_category'])['debt']\n",
    ".agg(['count', 'mean'])\n",
    ".sort_values('mean',ascending=False)\n",
    ".style\n",
    ".format({\n",
    "    'mean': '{:,.1%}'.format,\n",
    "})\n",
    ".applymap(\n",
    "     lambda x: 'background-color : red' if x>0.081 else '', \n",
    "     subset=['mean']))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 69,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style  type=\"text/css\" >\n",
       "    #T_14e2cc70_f810_11e9_a7b6_02420a00087drow0_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_14e2cc70_f810_11e9_a7b6_02420a00087drow1_col1 {\n",
       "            background-color :  red;\n",
       "        }</style><table id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087d\" ><thead>    <tr>        <th class=\"blank level0\" ></th>        <th class=\"col_heading level0 col0\" >count</th>        <th class=\"col_heading level0 col1\" >mean</th>    </tr>    <tr>        <th class=\"index_name level0\" >family_status</th>        <th class=\"blank\" ></th>        <th class=\"blank\" ></th>    </tr></thead><tbody>\n",
       "                <tr>\n",
       "                        <th id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087dlevel0_row0\" class=\"row_heading level0 row0\" >не женат / не замужем</th>\n",
       "                        <td id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087drow0_col0\" class=\"data row0 col0\" >2810</td>\n",
       "                        <td id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087drow0_col1\" class=\"data row0 col1\" >9.8%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087dlevel0_row1\" class=\"row_heading level0 row1\" >гражданский брак</th>\n",
       "                        <td id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087drow1_col0\" class=\"data row1 col0\" >4151</td>\n",
       "                        <td id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087drow1_col1\" class=\"data row1 col1\" >9.3%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087dlevel0_row2\" class=\"row_heading level0 row2\" >женат / замужем</th>\n",
       "                        <td id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087drow2_col0\" class=\"data row2 col0\" >12339</td>\n",
       "                        <td id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087drow2_col1\" class=\"data row2 col1\" >7.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087dlevel0_row3\" class=\"row_heading level0 row3\" >в разводе</th>\n",
       "                        <td id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087drow3_col0\" class=\"data row3 col0\" >1195</td>\n",
       "                        <td id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087drow3_col1\" class=\"data row3 col1\" >7.1%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087dlevel0_row4\" class=\"row_heading level0 row4\" >вдовец / вдова</th>\n",
       "                        <td id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087drow4_col0\" class=\"data row4 col0\" >959</td>\n",
       "                        <td id=\"T_14e2cc70_f810_11e9_a7b6_02420a00087drow4_col1\" class=\"data row4 col1\" >6.6%</td>\n",
       "            </tr>\n",
       "    </tbody></table>"
      ],
      "text/plain": [
       "<pandas.io.formats.style.Styler at 0x7ffb58f74320>"
      ]
     },
     "execution_count": 69,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "(ks.groupby(['family_status'])['debt']\n",
    ".agg(['count', 'mean'])\n",
    ".sort_values('mean',ascending=False)\n",
    ".style\n",
    ".format({\n",
    "    'mean': '{:,.1%}'.format,\n",
    "})\n",
    ".applymap(\n",
    "     lambda x: 'background-color : red' if x>0.081 else '', \n",
    "     subset=['mean']))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Клиенты которые состоят в браке лучше выплачивают кредит, что логично.  \n",
    "Также стоит отметить, что выборка по клиентам \"Не в браке\" в 3 раза меньше, т.е при большей выборке процент может ещё увеличиться."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Да, действительно люди в браке лучше возвращают кредиты, но если мы оценим отдельные категории, то заметим, что наиболее рисковые группы это те люди, которые никогда не состояли в официально зарегистрированных отношениях\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "- Есть ли зависимость между уровнем дохода и возвратом кредита в срок?"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 70,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style  type=\"text/css\" >\n",
       "    #T_14e729aa_f810_11e9_a7b6_02420a00087drow0_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_14e729aa_f810_11e9_a7b6_02420a00087drow1_col1 {\n",
       "            background-color :  red;\n",
       "        }</style><table id=\"T_14e729aa_f810_11e9_a7b6_02420a00087d\" ><thead>    <tr>        <th class=\"blank level0\" ></th>        <th class=\"col_heading level0 col0\" >count</th>        <th class=\"col_heading level0 col1\" >mean</th>    </tr>    <tr>        <th class=\"index_name level0\" >income_level</th>        <th class=\"blank\" ></th>        <th class=\"blank\" ></th>    </tr></thead><tbody>\n",
       "                <tr>\n",
       "                        <th id=\"T_14e729aa_f810_11e9_a7b6_02420a00087dlevel0_row0\" class=\"row_heading level0 row0\" >Средний уровень дохода</th>\n",
       "                        <td id=\"T_14e729aa_f810_11e9_a7b6_02420a00087drow0_col0\" class=\"data row0 col0\" >5363</td>\n",
       "                        <td id=\"T_14e729aa_f810_11e9_a7b6_02420a00087drow0_col1\" class=\"data row0 col1\" >9.0%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14e729aa_f810_11e9_a7b6_02420a00087dlevel0_row1\" class=\"row_heading level0 row1\" >Высокий уровень дохода</th>\n",
       "                        <td id=\"T_14e729aa_f810_11e9_a7b6_02420a00087drow1_col0\" class=\"data row1 col0\" >5363</td>\n",
       "                        <td id=\"T_14e729aa_f810_11e9_a7b6_02420a00087drow1_col1\" class=\"data row1 col1\" >8.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14e729aa_f810_11e9_a7b6_02420a00087dlevel0_row2\" class=\"row_heading level0 row2\" >Низкий уровень дохода</th>\n",
       "                        <td id=\"T_14e729aa_f810_11e9_a7b6_02420a00087drow2_col0\" class=\"data row2 col0\" >5364</td>\n",
       "                        <td id=\"T_14e729aa_f810_11e9_a7b6_02420a00087drow2_col1\" class=\"data row2 col1\" >8.0%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14e729aa_f810_11e9_a7b6_02420a00087dlevel0_row3\" class=\"row_heading level0 row3\" >Сверхвысокий уровень дохода</th>\n",
       "                        <td id=\"T_14e729aa_f810_11e9_a7b6_02420a00087drow3_col0\" class=\"data row3 col0\" >5364</td>\n",
       "                        <td id=\"T_14e729aa_f810_11e9_a7b6_02420a00087drow3_col1\" class=\"data row3 col1\" >7.0%</td>\n",
       "            </tr>\n",
       "    </tbody></table>"
      ],
      "text/plain": [
       "<pandas.io.formats.style.Styler at 0x7ffb1e993f60>"
      ]
     },
     "execution_count": 70,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "(ks.groupby(['income_level'])['debt']\n",
    ".agg(['count', 'mean'])\n",
    ".sort_values('mean',ascending=False)\n",
    ".style\n",
    ".format({\n",
    "    'mean': '{:,.1%}'.format,\n",
    "})\n",
    ".applymap(\n",
    "     lambda x: 'background-color : red' if x>0.081 else '', \n",
    "     subset=['mean']))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Клиенты с низким уровнем дохода платят лучше, чем со средним и высоким, что странно.  \n",
    "Посмотрим подробнее."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 71,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style  type=\"text/css\" >\n",
       "    #T_14f393a2_f810_11e9_a7b6_02420a00087drow0_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_14f393a2_f810_11e9_a7b6_02420a00087drow1_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_14f393a2_f810_11e9_a7b6_02420a00087drow2_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_14f393a2_f810_11e9_a7b6_02420a00087drow3_col1 {\n",
       "            background-color :  red;\n",
       "        }</style><table id=\"T_14f393a2_f810_11e9_a7b6_02420a00087d\" ><thead>    <tr>        <th class=\"blank\" ></th>        <th class=\"blank level0\" ></th>        <th class=\"col_heading level0 col0\" >count</th>        <th class=\"col_heading level0 col1\" >mean</th>    </tr>    <tr>        <th class=\"index_name level0\" >income_level</th>        <th class=\"index_name level1\" >kids</th>        <th class=\"blank\" ></th>        <th class=\"blank\" ></th>    </tr></thead><tbody>\n",
       "                <tr>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel0_row0\" class=\"row_heading level0 row0\" >Средний уровень дохода</th>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel1_row0\" class=\"row_heading level1 row0\" >Есть дети</th>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow0_col0\" class=\"data row0 col0\" >1824</td>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow0_col1\" class=\"data row0 col1\" >10.1%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel0_row1\" class=\"row_heading level0 row1\" >Высокий уровень дохода</th>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel1_row1\" class=\"row_heading level1 row1\" >Есть дети</th>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow1_col0\" class=\"data row1 col0\" >1901</td>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow1_col1\" class=\"data row1 col1\" >9.8%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel0_row2\" class=\"row_heading level0 row2\" >Низкий уровень дохода</th>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel1_row2\" class=\"row_heading level1 row2\" >Есть дети</th>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow2_col0\" class=\"data row2 col0\" >1722</td>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow2_col1\" class=\"data row2 col1\" >9.6%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel0_row3\" class=\"row_heading level0 row3\" >Средний уровень дохода</th>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel1_row3\" class=\"row_heading level1 row3\" >Нет детей</th>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow3_col0\" class=\"data row3 col0\" >3539</td>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow3_col1\" class=\"data row3 col1\" >8.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel0_row4\" class=\"row_heading level0 row4\" >Высокий уровень дохода</th>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel1_row4\" class=\"row_heading level1 row4\" >Нет детей</th>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow4_col0\" class=\"data row4 col0\" >3462</td>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow4_col1\" class=\"data row4 col1\" >7.8%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel0_row5\" class=\"row_heading level0 row5\" >Сверхвысокий уровень дохода</th>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel1_row5\" class=\"row_heading level1 row5\" >Есть дети</th>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow5_col0\" class=\"data row5 col0\" >1916</td>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow5_col1\" class=\"data row5 col1\" >7.4%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel0_row6\" class=\"row_heading level0 row6\" >Низкий уровень дохода</th>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel1_row6\" class=\"row_heading level1 row6\" >Нет детей</th>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow6_col0\" class=\"data row6 col0\" >3642</td>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow6_col1\" class=\"data row6 col1\" >7.2%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel0_row7\" class=\"row_heading level0 row7\" >Сверхвысокий уровень дохода</th>\n",
       "                        <th id=\"T_14f393a2_f810_11e9_a7b6_02420a00087dlevel1_row7\" class=\"row_heading level1 row7\" >Нет детей</th>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow7_col0\" class=\"data row7 col0\" >3448</td>\n",
       "                        <td id=\"T_14f393a2_f810_11e9_a7b6_02420a00087drow7_col1\" class=\"data row7 col1\" >6.7%</td>\n",
       "            </tr>\n",
       "    </tbody></table>"
      ],
      "text/plain": [
       "<pandas.io.formats.style.Styler at 0x7ffb3c3279b0>"
      ]
     },
     "execution_count": 71,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "(ks.groupby(['income_level','kids'])['debt']\n",
    ".agg(['count', 'mean'])\n",
    ".sort_values('mean',ascending=False)\n",
    ".style\n",
    ".format({\n",
    "    'mean': '{:,.1%}'.format,\n",
    "})\n",
    ".applymap(\n",
    "     lambda x: 'background-color : red' if x>0.081 else '', \n",
    "     subset=['mean']))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Как вариант можно предположить, что люди со средним и высоким уровнем дохода брали кредит на большую сумму(например ипотека)\n",
    "и после рождения детей на время декрета одного из родителей из-за снижения уровня дохода имели просрочки по кредитам.  \n",
    "Люди с низким уровнем дохода обычно более осмотрительно берут кредиты.  \n",
    "Также люди с высоким уровнем дохода могут менее ответственно подходить к погашению кредита, так как не бояться процента за просрочку.  \n",
    "В любом случае видна корреляция с наличием детей.  \n",
    "Также стоит отметить, что есть очевидные проблемы с данными по доходам начиная с пропусков, заканчивая аномальными значениями."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Да, ты прав, хорошие выводы. Действительно люди среднего дохода и высокого хуже всех погашают кредит.\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "- Как разные цели кредита влияют на его возврат в срок?"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 72,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style  type=\"text/css\" >\n",
       "    #T_14f7e4de_f810_11e9_a7b6_02420a00087drow0_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_14f7e4de_f810_11e9_a7b6_02420a00087drow1_col1 {\n",
       "            background-color :  red;\n",
       "        }</style><table id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087d\" ><thead>    <tr>        <th class=\"blank level0\" ></th>        <th class=\"col_heading level0 col0\" >count</th>        <th class=\"col_heading level0 col1\" >mean</th>    </tr>    <tr>        <th class=\"index_name level0\" >purpose_cat</th>        <th class=\"blank\" ></th>        <th class=\"blank\" ></th>    </tr></thead><tbody>\n",
       "                <tr>\n",
       "                        <th id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087dlevel0_row0\" class=\"row_heading level0 row0\" >автомобиль</th>\n",
       "                        <td id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087drow0_col0\" class=\"data row0 col0\" >4306</td>\n",
       "                        <td id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087drow0_col1\" class=\"data row0 col1\" >9.4%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087dlevel0_row1\" class=\"row_heading level0 row1\" >образование</th>\n",
       "                        <td id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087drow1_col0\" class=\"data row1 col0\" >4013</td>\n",
       "                        <td id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087drow1_col1\" class=\"data row1 col1\" >9.2%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087dlevel0_row2\" class=\"row_heading level0 row2\" >свадьба</th>\n",
       "                        <td id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087drow2_col0\" class=\"data row2 col0\" >2324</td>\n",
       "                        <td id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087drow2_col1\" class=\"data row2 col1\" >8.0%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087dlevel0_row3\" class=\"row_heading level0 row3\" >недвижимость</th>\n",
       "                        <td id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087drow3_col0\" class=\"data row3 col0\" >6351</td>\n",
       "                        <td id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087drow3_col1\" class=\"data row3 col1\" >7.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087dlevel0_row4\" class=\"row_heading level0 row4\" >жилье</th>\n",
       "                        <td id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087drow4_col0\" class=\"data row4 col0\" >4460</td>\n",
       "                        <td id=\"T_14f7e4de_f810_11e9_a7b6_02420a00087drow4_col1\" class=\"data row4 col1\" >6.9%</td>\n",
       "            </tr>\n",
       "    </tbody></table>"
      ],
      "text/plain": [
       "<pandas.io.formats.style.Styler at 0x7ffb1e999be0>"
      ]
     },
     "execution_count": 72,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "(ks.groupby(['purpose_cat'])['debt']\n",
    ".agg(['count', 'mean'])\n",
    ".sort_values('mean',ascending=False)\n",
    ".style\n",
    ".format({\n",
    "    'mean': '{:,.1%}'.format,\n",
    "})\n",
    ".applymap(\n",
    "     lambda x: 'background-color : red' if x>0.081 else '', \n",
    "     subset=['mean']))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 73,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style  type=\"text/css\" >\n",
       "    #T_1508eec8_f810_11e9_a7b6_02420a00087drow0_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_1508eec8_f810_11e9_a7b6_02420a00087drow1_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_1508eec8_f810_11e9_a7b6_02420a00087drow2_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_1508eec8_f810_11e9_a7b6_02420a00087drow3_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_1508eec8_f810_11e9_a7b6_02420a00087drow4_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_1508eec8_f810_11e9_a7b6_02420a00087drow5_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_1508eec8_f810_11e9_a7b6_02420a00087drow6_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_1508eec8_f810_11e9_a7b6_02420a00087drow7_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_1508eec8_f810_11e9_a7b6_02420a00087drow8_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_1508eec8_f810_11e9_a7b6_02420a00087drow9_col1 {\n",
       "            background-color :  red;\n",
       "        }</style><table id=\"T_1508eec8_f810_11e9_a7b6_02420a00087d\" ><thead>    <tr>        <th class=\"blank\" ></th>        <th class=\"blank level0\" ></th>        <th class=\"col_heading level0 col0\" >count</th>        <th class=\"col_heading level0 col1\" >mean</th>    </tr>    <tr>        <th class=\"index_name level0\" >family_status</th>        <th class=\"index_name level1\" >purpose_cat</th>        <th class=\"blank\" ></th>        <th class=\"blank\" ></th>    </tr></thead><tbody>\n",
       "                <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row0\" class=\"row_heading level0 row0\" >гражданский брак</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row0\" class=\"row_heading level1 row0\" >образование</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow0_col0\" class=\"data row0 col0\" >404</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow0_col1\" class=\"data row0 col1\" >14.9%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row1\" class=\"row_heading level0 row1\" >не женат / не замужем</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row1\" class=\"row_heading level1 row1\" >автомобиль</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow1_col0\" class=\"data row1 col0\" >637</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow1_col1\" class=\"data row1 col1\" >12.9%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row2\" class=\"row_heading level0 row2\" >гражданский брак</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row2\" class=\"row_heading level1 row2\" >автомобиль</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow2_col0\" class=\"data row2 col0\" >434</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow2_col1\" class=\"data row2 col1\" >11.8%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row3\" class=\"row_heading level0 row3\" >не женат / не замужем</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row3\" class=\"row_heading level1 row3\" >образование</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow3_col0\" class=\"data row3 col0\" >577</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow3_col1\" class=\"data row3 col1\" >10.7%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row4\" class=\"row_heading level0 row4\" >гражданский брак</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row4\" class=\"row_heading level1 row4\" >недвижимость</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow4_col0\" class=\"data row4 col0\" >586</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow4_col1\" class=\"data row4 col1\" >9.4%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row5\" class=\"row_heading level0 row5\" >вдовец / вдова</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row5\" class=\"row_heading level1 row5\" >автомобиль</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow5_col0\" class=\"data row5 col0\" >218</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow5_col1\" class=\"data row5 col1\" >9.2%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row6\" class=\"row_heading level0 row6\" >гражданский брак</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row6\" class=\"row_heading level1 row6\" >жилье</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow6_col0\" class=\"data row6 col0\" >403</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow6_col1\" class=\"data row6 col1\" >8.9%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row7\" class=\"row_heading level0 row7\" >не женат / не замужем</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row7\" class=\"row_heading level1 row7\" >недвижимость</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow7_col0\" class=\"data row7 col0\" >937</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow7_col1\" class=\"data row7 col1\" >8.6%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row8\" class=\"row_heading level0 row8\" rowspan=2>женат / замужем</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row8\" class=\"row_heading level1 row8\" >автомобиль</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow8_col0\" class=\"data row8 col0\" >2736</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow8_col1\" class=\"data row8 col1\" >8.4%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                                <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row9\" class=\"row_heading level1 row9\" >образование</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow9_col0\" class=\"data row9 col0\" >2595</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow9_col1\" class=\"data row9 col1\" >8.3%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row10\" class=\"row_heading level0 row10\" >гражданский брак</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row10\" class=\"row_heading level1 row10\" >свадьба</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow10_col0\" class=\"data row10 col0\" >2324</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow10_col1\" class=\"data row10 col1\" >8.0%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row11\" class=\"row_heading level0 row11\" >вдовец / вдова</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row11\" class=\"row_heading level1 row11\" >образование</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow11_col0\" class=\"data row11 col0\" >199</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow11_col1\" class=\"data row11 col1\" >7.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row12\" class=\"row_heading level0 row12\" >в разводе</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row12\" class=\"row_heading level1 row12\" >автомобиль</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow12_col0\" class=\"data row12 col0\" >281</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow12_col1\" class=\"data row12 col1\" >7.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row13\" class=\"row_heading level0 row13\" >не женат / не замужем</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row13\" class=\"row_heading level1 row13\" >жилье</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow13_col0\" class=\"data row13 col0\" >659</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow13_col1\" class=\"data row13 col1\" >7.4%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row14\" class=\"row_heading level0 row14\" >женат / замужем</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row14\" class=\"row_heading level1 row14\" >недвижимость</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow14_col0\" class=\"data row14 col0\" >4103</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow14_col1\" class=\"data row14 col1\" >7.2%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row15\" class=\"row_heading level0 row15\" rowspan=3>в разводе</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row15\" class=\"row_heading level1 row15\" >образование</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow15_col0\" class=\"data row15 col0\" >238</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow15_col1\" class=\"data row15 col1\" >7.1%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                                <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row16\" class=\"row_heading level1 row16\" >жилье</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow16_col0\" class=\"data row16 col0\" >267</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow16_col1\" class=\"data row16 col1\" >7.1%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                                <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row17\" class=\"row_heading level1 row17\" >недвижимость</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow17_col0\" class=\"data row17 col0\" >409</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow17_col1\" class=\"data row17 col1\" >6.8%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row18\" class=\"row_heading level0 row18\" >женат / замужем</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row18\" class=\"row_heading level1 row18\" >жилье</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow18_col0\" class=\"data row18 col0\" >2905</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow18_col1\" class=\"data row18 col1\" >6.6%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel0_row19\" class=\"row_heading level0 row19\" rowspan=2>вдовец / вдова</th>\n",
       "                        <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row19\" class=\"row_heading level1 row19\" >жилье</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow19_col0\" class=\"data row19 col0\" >226</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow19_col1\" class=\"data row19 col1\" >5.3%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                                <th id=\"T_1508eec8_f810_11e9_a7b6_02420a00087dlevel1_row20\" class=\"row_heading level1 row20\" >недвижимость</th>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow20_col0\" class=\"data row20 col0\" >316</td>\n",
       "                        <td id=\"T_1508eec8_f810_11e9_a7b6_02420a00087drow20_col1\" class=\"data row20 col1\" >5.1%</td>\n",
       "            </tr>\n",
       "    </tbody></table>"
      ],
      "text/plain": [
       "<pandas.io.formats.style.Styler at 0x7ffb3d4ad6a0>"
      ]
     },
     "execution_count": 73,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "(ks.groupby(['family_status','purpose_cat'])['debt']\n",
    ".agg(['count', 'mean'])\n",
    ".sort_values('mean',ascending=False)\n",
    ".style\n",
    ".format({\n",
    "    'mean': '{:,.1%}'.format,\n",
    "})\n",
    ".applymap(\n",
    "     lambda x: 'background-color : red' if x>0.081 else '', \n",
    "     subset=['mean']))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Больше всего просрочек по кредитам на автомобиль 9.4% и образование 9.2%.  \n",
    "Стоит уделить внимание клиентам из в гражданском браке и не женатым, которы берут кредиты на данные цели. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Да, действительно автомобиль и образование наиболее рисковые цели, тогда как недвижимость и свадьбы наоборот.\n",
    "\n",
    "Молодец, что провел дополнительную группировку по семейному статусу!\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Шаг 4. Общий вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Перед тем как делать общий вывод посмотрим общую картину по всем категориям.  \n",
    "Уровень дохода не берём, так как есть сомнения в его корректности."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 74,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<style  type=\"text/css\" >\n",
       "    #T_15199d90_f810_11e9_a7b6_02420a00087drow0_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_15199d90_f810_11e9_a7b6_02420a00087drow1_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_15199d90_f810_11e9_a7b6_02420a00087drow2_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_15199d90_f810_11e9_a7b6_02420a00087drow3_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_15199d90_f810_11e9_a7b6_02420a00087drow4_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_15199d90_f810_11e9_a7b6_02420a00087drow5_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_15199d90_f810_11e9_a7b6_02420a00087drow6_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_15199d90_f810_11e9_a7b6_02420a00087drow7_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_15199d90_f810_11e9_a7b6_02420a00087drow8_col1 {\n",
       "            background-color :  red;\n",
       "        }    #T_15199d90_f810_11e9_a7b6_02420a00087drow9_col1 {\n",
       "            background-color :  red;\n",
       "        }</style><table id=\"T_15199d90_f810_11e9_a7b6_02420a00087d\" ><thead>    <tr>        <th class=\"blank\" ></th>        <th class=\"blank\" ></th>        <th class=\"blank level0\" ></th>        <th class=\"col_heading level0 col0\" >count</th>        <th class=\"col_heading level0 col1\" >mean</th>    </tr>    <tr>        <th class=\"index_name level0\" >purpose_cat</th>        <th class=\"index_name level1\" >kids</th>        <th class=\"index_name level2\" >family_status_category</th>        <th class=\"blank\" ></th>        <th class=\"blank\" ></th>    </tr></thead><tbody>\n",
       "                <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row0\" class=\"row_heading level0 row0\" rowspan=2>автомобиль</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row0\" class=\"row_heading level1 row0\" rowspan=2>Есть дети</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row0\" class=\"row_heading level2 row0\" >Не в браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow0_col0\" class=\"data row0 col0\" >222</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow0_col1\" class=\"data row0 col1\" >12.2%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row1\" class=\"row_heading level2 row1\" >В браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow1_col0\" class=\"data row1 col0\" >1239</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow1_col1\" class=\"data row1 col1\" >10.7%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row2\" class=\"row_heading level0 row2\" >образование</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row2\" class=\"row_heading level1 row2\" >Есть дети</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row2\" class=\"row_heading level2 row2\" >В браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow2_col0\" class=\"data row2 col0\" >1148</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow2_col1\" class=\"data row2 col1\" >10.7%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row3\" class=\"row_heading level0 row3\" >автомобиль</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row3\" class=\"row_heading level1 row3\" >Нет детей</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row3\" class=\"row_heading level2 row3\" >Не в браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow3_col0\" class=\"data row3 col0\" >914</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow3_col1\" class=\"data row3 col1\" >10.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row4\" class=\"row_heading level0 row4\" >недвижимость</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row4\" class=\"row_heading level1 row4\" >Есть дети</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row4\" class=\"row_heading level2 row4\" >Не в браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow4_col0\" class=\"data row4 col0\" >385</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow4_col1\" class=\"data row4 col1\" >10.1%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row5\" class=\"row_heading level0 row5\" >образование</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row5\" class=\"row_heading level1 row5\" >Нет детей</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row5\" class=\"row_heading level2 row5\" >Не в браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow5_col0\" class=\"data row5 col0\" >791</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow5_col1\" class=\"data row5 col1\" >9.6%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row6\" class=\"row_heading level0 row6\" >свадьба</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row6\" class=\"row_heading level1 row6\" >Есть дети</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row6\" class=\"row_heading level2 row6\" >В браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow6_col0\" class=\"data row6 col0\" >794</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow6_col1\" class=\"data row6 col1\" >8.9%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row7\" class=\"row_heading level0 row7\" >недвижимость</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row7\" class=\"row_heading level1 row7\" >Есть дети</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row7\" class=\"row_heading level2 row7\" >В браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow7_col0\" class=\"data row7 col0\" >1793</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow7_col1\" class=\"data row7 col1\" >8.4%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row8\" class=\"row_heading level0 row8\" >жилье</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row8\" class=\"row_heading level1 row8\" >Есть дети</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row8\" class=\"row_heading level2 row8\" >Не в браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow8_col0\" class=\"data row8 col0\" >241</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow8_col1\" class=\"data row8 col1\" >8.3%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row9\" class=\"row_heading level0 row9\" rowspan=2>образование</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row9\" class=\"row_heading level1 row9\" >Нет детей</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row9\" class=\"row_heading level2 row9\" >В браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow9_col0\" class=\"data row9 col0\" >1851</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow9_col1\" class=\"data row9 col1\" >8.3%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                                <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row10\" class=\"row_heading level1 row10\" >Есть дети</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row10\" class=\"row_heading level2 row10\" >Не в браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow10_col0\" class=\"data row10 col0\" >223</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow10_col1\" class=\"data row10 col1\" >8.1%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row11\" class=\"row_heading level0 row11\" >автомобиль</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row11\" class=\"row_heading level1 row11\" >Нет детей</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row11\" class=\"row_heading level2 row11\" >В браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow11_col0\" class=\"data row11 col0\" >1931</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow11_col1\" class=\"data row11 col1\" >7.6%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row12\" class=\"row_heading level0 row12\" >свадьба</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row12\" class=\"row_heading level1 row12\" >Нет детей</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row12\" class=\"row_heading level2 row12\" >В браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow12_col0\" class=\"data row12 col0\" >1530</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow12_col1\" class=\"data row12 col1\" >7.5%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row13\" class=\"row_heading level0 row13\" >жилье</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row13\" class=\"row_heading level1 row13\" >Есть дети</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row13\" class=\"row_heading level2 row13\" >В браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow13_col0\" class=\"data row13 col0\" >1318</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow13_col1\" class=\"data row13 col1\" >7.3%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row14\" class=\"row_heading level0 row14\" rowspan=2>недвижимость</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row14\" class=\"row_heading level1 row14\" rowspan=2>Нет детей</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row14\" class=\"row_heading level2 row14\" >В браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow14_col0\" class=\"data row14 col0\" >2896</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow14_col1\" class=\"data row14 col1\" >6.8%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row15\" class=\"row_heading level2 row15\" >Не в браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow15_col0\" class=\"data row15 col0\" >1277</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow15_col1\" class=\"data row15 col1\" >6.7%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel0_row16\" class=\"row_heading level0 row16\" rowspan=2>жилье</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel1_row16\" class=\"row_heading level1 row16\" rowspan=2>Нет детей</th>\n",
       "                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row16\" class=\"row_heading level2 row16\" >В браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow16_col0\" class=\"data row16 col0\" >1990</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow16_col1\" class=\"data row16 col1\" >6.6%</td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                                        <th id=\"T_15199d90_f810_11e9_a7b6_02420a00087dlevel2_row17\" class=\"row_heading level2 row17\" >Не в браке</th>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow17_col0\" class=\"data row17 col0\" >911</td>\n",
       "                        <td id=\"T_15199d90_f810_11e9_a7b6_02420a00087drow17_col1\" class=\"data row17 col1\" >6.6%</td>\n",
       "            </tr>\n",
       "    </tbody></table>"
      ],
      "text/plain": [
       "<pandas.io.formats.style.Styler at 0x7ffb3c327be0>"
      ]
     },
     "execution_count": 74,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "(ks.groupby(['purpose_cat','kids','family_status_category',])['debt']\n",
    ".agg(['count', 'mean'])\n",
    ".sort_values('mean',ascending=False)\n",
    ".style\n",
    ".format({\n",
    "    'mean': '{:,.1%}'.format,\n",
    "})\n",
    ".applymap(\n",
    "     lambda x: 'background-color : red' if x>0.081 else '', \n",
    "     subset=['mean']))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Вывод"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "- **8.1%** клиентов имели задолженность по возврату кредитов.  \n",
    "- Есть зависимость между наличием детей, семейным положением, уровнем дохода и целей кредита на его возврат в срок, но при этом нет явной корелляции между показателями. В среднем разница около **4%**.\n",
    "- Нужно обратить внимание на клиентов из категории **\"Не в браке\" и \"Есть дети\"**. Посмотреть динамику на более объёмной выборке.\n",
    "- Из целей кредита повышенный процент просрочек в кредите на **автомобиль,образование и недвижимость**, особенно у клиентов с **детьми и в браке**.\n",
    "- В среднем клиенты **без детей** реже имеют задолженность по кредитам, кроме категории **автокредитов**.\n",
    "\n",
    "В качестве общей рекомендации заказчику следует обратить внимание на верификацию и андеррайтинг анкеты данных по заёмщикам.  \n",
    "Есть большое колличество проблем в качестве данных, в частности в одной из ключевых метрик уровня дохода клиента.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<div class=\"alert alert-block alert-success\">\n",
    "<b>КОММЕНТАРИЙ РЕВЬЮВЕРА 2:</b> \n",
    "\n",
    "Молодец, получилась очень хорошая сводная таблица, мы можем много из нее узнать. Вывод тоже правильный, не смотря на явную безопасность отдельных целей просто по срезу целей, мы видим, что в совместном анализе они уже не выглядят настолько надежными. Необходимо учитывать набор факторов, так скажем их взаимодействие.\n",
    "\n",
    "Именно такие задачи и решает машинное обучение! Если будет интересно углубись)\n",
    "</div>"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.8"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": true,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {},
   "toc_section_display": true,
   "toc_window_display": false
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
